import os
import re
import json
from datetime import datetime

# Regex pattern to identify stack traces
STACK_TRACE_PATTERN = r'at\s+\S+\.\S+\s*\(.*\.java:\d*\)'

# Path to the main bug reports folder of Pathidea_Data
REPO_PATH = '/Users/fahim/Desktop/PhD/Projects/Pathidea_Data/bug_reports/Zookeeper'



# Function to check if bug report meets criteria
def meets_criteria(data):
    # Check if 'fields' is present and valid
    fields = data.get("fields")
    if not fields:
        return False

    # Safely access 'resolution' field and check its 'name'
    resolution = fields.get("resolution")
    if not resolution or resolution.get("name") not in ["Resolved", "Fixed"]:
        return False

    # Safely access 'priority' field and check its 'name'
    priority = fields.get("priority")
    if not priority or priority.get("name") not in ["Major", "Critical", "Blocker"]:
        return False

    # Check the 'created' field and ensure it is 2010 or later
    created_date_str = fields.get("created")
    if created_date_str:
        try:
            created_date = datetime.fromisoformat(created_date_str.replace("Z", "+00:00"))
            if created_date.year < 2010:
                return False
        except ValueError:
            print(f"Warning: Invalid date format in 'created' field: {created_date_str}")
            return False
    else:
        return False

    return True





# Function to recursively scan JSON files for stack traces
def get_bug_reports_with_stack_traces(path, excluded_folders, filename_list):
    bug_reports = []

    for root, dirs, files in os.walk(path):
        # Exclude specified folders from the traversal
        dirs[:] = [d for d in dirs if d not in excluded_folders]

        for filename in files:
            file_path = os.path.join(root, filename)

            # Check if the file is a JSON file and in filename_list
            if file_path.endswith('.json') and ((filename.split(".")[0]) in filename_list):
                try:
                    with open(file_path, 'r', encoding='utf-8') as file:
                        data = json.load(file)
                        content = json.dumps(data)
                        # content = file.read()  # Read the raw content as text
                        if re.search(STACK_TRACE_PATTERN, content) and meets_criteria(data):
                            bug_reports.append({
                                'filename': filename,
                                # 'path': file_path,
                                # 'content': data
                                'creation_time': data["fields"]["created"],
                                'bug_report': data
                                # 'description' : data["fields"]["description"]
                            })

                # except Exception as e:
                #     print(f"Warning: Could not read file {file_path}. Error: {e}")
                except json.JSONDecodeError as e:
                    print(f"Warning: Could not decode JSON in file {file_path}. Error: {e}")

    return bug_reports

# Main function
def main():
    # List of folder to exclude checking
    excluded_folders = ['comments', 'details']

    # List of filenames to filter
    filename_list = ['AMQ-1063', 'AMQ-1188', 'AMQ-1346', 'AMQ-1498', 'AMQ-1849', 'AMQ-1970', 'AMQ-1979', 'AMQ-2052', 'AMQ-2119', 'AMQ-2191', 'AMQ-2212', 'AMQ-2285', 'AMQ-2303', 'AMQ-2305', 'AMQ-2322', 'AMQ-2472', 'AMQ-2513', 'AMQ-2551', 'AMQ-2553', 'AMQ-2584', 'AMQ-2677', 'AMQ-2693', 'AMQ-2730', 'AMQ-2774', 'AMQ-2891', 'AMQ-2902', 'AMQ-2963', 'AMQ-2965', 'AMQ-3056', 'AMQ-3085', 'AMQ-3088', 'AMQ-3176', 'AMQ-3180', 'AMQ-3316', 'AMQ-3325', 'AMQ-3393', 'AMQ-3434', 'AMQ-3443', 'AMQ-3490', 'AMQ-3504', 'AMQ-3539', 'AMQ-3599', 'AMQ-3622', 'AMQ-3725', 'AMQ-3887', 'AMQ-3903', 'AMQ-3988', 'AMQ-4031', 'AMQ-4044', 'AMQ-4092', 'AMQ-4118', 'AMQ-4221', 'AMQ-4369', 'AMQ-4407', 'AMQ-4643', 'AMQ-4841', 'AMQ-4950', 'AMQ-4977', 'AMQ-5016', 'AMQ-5086', 'AMQ-5141', 'AMQ-5241', 'AMQ-5384', 'AMQ-5394', 'AMQ-5493', 'AMQ-5525', 'AMQ-5665', 'AMQ-5743', 'AMQ-5783', 'AMQ-5815', 'AMQ-5854', 'AMQ-5917', 'AMQ-6016', 'AMQ-6071', 'AMQ-6094', 'AMQ-6432', 'AMQ-6451', 'AMQ-6548', 'AMQ-6602', 'AMQ-6667', 'AMQ-6707', 'AMQ-6831', 'AMQ-6847', 'AMQ-7012', 'AMQ-7013', 'AMQ-7079', 'HADOOP-1001', 'HADOOP-1011', 'HADOOP-10126', 'HADOOP-10142', 'HADOOP-1020', 'HADOOP-10251', 'HADOOP-10252', 'HADOOP-10468', 'HADOOP-1046', 'HADOOP-1049', 'HADOOP-10540', 'HADOOP-10542', 'HADOOP-1060', 'HADOOP-10622', 'HADOOP-10683', 'HADOOP-10702', 'HADOOP-1070', 'HADOOP-1071', 'HADOOP-10823', 'HADOOP-10866', 'HADOOP-10937', 'HADOOP-1093', 'HADOOP-10941', 'HADOOP-10945', 'HADOOP-1099', 'HADOOP-11149', 'HADOOP-11151', 'HADOOP-1122', 'HADOOP-11238', 'HADOOP-1123', 'HADOOP-11260', 'HADOOP-11400', 'HADOOP-11446', 'HADOOP-1152', 'HADOOP-11685', 'HADOOP-11693', 'HADOOP-11722', 'HADOOP-11754', 'HADOOP-1179', 'HADOOP-11878', 'HADOOP-1189', 'HADOOP-11934', 'HADOOP-11962', 'HADOOP-1200', 'HADOOP-12089', 'HADOOP-12186', 'HADOOP-12239', 'HADOOP-12252', 'HADOOP-12304', 'HADOOP-12317', 'HADOOP-1242', 'HADOOP-12441', 'HADOOP-12611', 'HADOOP-12622', 'HADOOP-12689', 'HADOOP-12699', 'HADOOP-12862', 'HADOOP-12903', 'HADOOP-13132', 'HADOOP-1332', 'HADOOP-13381', 'HADOOP-13387', 'HADOOP-13487', 'HADOOP-13512', 'HADOOP-13526', 'HADOOP-13770', 'HADOOP-13890', 'HADOOP-13988', 'HADOOP-14062', 'HADOOP-1407', 'HADOOP-14701', 'HADOOP-14727', 'HADOOP-14743', 'HADOOP-14919', 'HADOOP-14942', 'HADOOP-14949', 'HADOOP-15059', 'HADOOP-15060', 'HADOOP-15121', 'HADOOP-15123', 'HADOOP-1513', 'HADOOP-15206', 'HADOOP-1520', 'HADOOP-15307', 'HADOOP-15331', 'HADOOP-15355', 'HADOOP-15390', 'HADOOP-15411', 'HADOOP-15772', 'HADOOP-15822', 'HADOOP-15850', 'HADOOP-15997', 'HADOOP-1619', 'HADOOP-1680', 'HADOOP-1712', 'HADOOP-1714', 'HADOOP-1716', 'HADOOP-1739', 'HADOOP-1740', 'HADOOP-1765', 'HADOOP-1874', 'HADOOP-1887', 'HADOOP-1930', 'HADOOP-1948', 'HADOOP-1955', 'HADOOP-1973', 'HADOOP-2016', 'HADOOP-2073', 'HADOOP-2080', 'HADOOP-2095', 'HADOOP-2119', 'HADOOP-2256', 'HADOOP-2323', 'HADOOP-2393', 'HADOOP-2404', 'HADOOP-2486', 'HADOOP-2492', 'HADOOP-2538', 'HADOOP-2549', 'HADOOP-2570', 'HADOOP-2669', 'HADOOP-2687', 'HADOOP-2691', 'HADOOP-2713', 'HADOOP-2725', 'HADOOP-2755', 'HADOOP-2756', 'HADOOP-2768', 'HADOOP-2789', 'HADOOP-2814', 'HADOOP-289', 'HADOOP-2905', 'HADOOP-2934', 'HADOOP-2971', 'HADOOP-2972', 'HADOOP-2974', 'HADOOP-2976', 'HADOOP-3027', 'HADOOP-3033', 'HADOOP-3035', 'HADOOP-3107', 'HADOOP-3108', 'HADOOP-3118', 'HADOOP-3130', 'HADOOP-3154', 'HADOOP-3155', 'HADOOP-3232', 'HADOOP-324', 'HADOOP-3269', 'HADOOP-3294', 'HADOOP-3403', 'HADOOP-3418', 'HADOOP-3509', 'HADOOP-3520', 'HADOOP-3537', 'HADOOP-3561', 'HADOOP-3571', 'HADOOP-3576', 'HADOOP-3590', 'HADOOP-3604', 'HADOOP-3633', 'HADOOP-3635', 'HADOOP-3670', 'HADOOP-3678', 'HADOOP-3681', 'HADOOP-3707', 'HADOOP-3724', 'HADOOP-3732', 'HADOOP-3758', 'HADOOP-3760', 'HADOOP-3813', 'HADOOP-3831', 'HADOOP-3859', 'HADOOP-3865', 'HADOOP-3883', 'HADOOP-3897', 'HADOOP-3961', 'HADOOP-4163', 'HADOOP-4173', 'HADOOP-4278', 'HADOOP-4288', 'HADOOP-4318', 'HADOOP-4351', 'HADOOP-4373', 'HADOOP-4422', 'HADOOP-4517', 'HADOOP-4526', 'HADOOP-4530', 'HADOOP-4595', 'HADOOP-4620', 'HADOOP-4647', 'HADOOP-4714', 'HADOOP-4716', 'HADOOP-4742', 'HADOOP-4744', 'HADOOP-4959', 'HADOOP-4967', 'HADOOP-5002', 'HADOOP-507', 'HADOOP-5146', 'HADOOP-5166', 'HADOOP-5191', 'HADOOP-5198', 'HADOOP-5233', 'HADOOP-5234', 'HADOOP-5241', 'HADOOP-5285', 'HADOOP-529', 'HADOOP-549', 'HADOOP-5539', 'HADOOP-5641', 'HADOOP-5759', 'HADOOP-5850', 'HADOOP-5869', 'HADOOP-6017', 'HADOOP-6132', 'HADOOP-6180', 'HADOOP-6281', 'HADOOP-6386', 'HADOOP-6452', 'HADOOP-6669', 'HADOOP-6760', 'HADOOP-6763', 'HADOOP-6989', 'HADOOP-705', 'HADOOP-745', 'HADOOP-750', 'HADOOP-7629', 'HADOOP-794', 'HADOOP-7988', 'HADOOP-8031', 'HADOOP-8110', 'HADOOP-8197', 'HADOOP-8202', 'HADOOP-8225', 'HADOOP-8422', 'HADOOP-8452', 'HADOOP-8589', 'HADOOP-8599', 'HADOOP-8721', 'HADOOP-8962', 'HADOOP-8963', 'HADOOP-898', 'HADOOP-9103', 'HADOOP-9125', 'HADOOP-924', 'HADOOP-934', 'HADOOP-9358', 'HADOOP-9364', 'HADOOP-949', 'HADOOP-973', 'HADOOP-984', 'HADOOP-9865', 'HADOOP-9894', 'HADOOP-990', 'HADOOP-9924', 'HADOOP-9977', 'HDFS-101', 'HDFS-1024', 'HDFS-10276', 'HDFS-10301', 'HDFS-10320', 'HDFS-10360', 'HDFS-10438', 'HDFS-10453', 'HDFS-10512', 'HDFS-10609', 'HDFS-10715', 'HDFS-10729', 'HDFS-10731', 'HDFS-10760', 'HDFS-1085', 'HDFS-10962', 'HDFS-10986', 'HDFS-11056', 'HDFS-11164', 'HDFS-11209', 'HDFS-11363', 'HDFS-11377', 'HDFS-11472', 'HDFS-11479', 'HDFS-11508', 'HDFS-11515', 'HDFS-11526', 'HDFS-11576', 'HDFS-1158', 'HDFS-11593', 'HDFS-11608', 'HDFS-11741', 'HDFS-11751', 'HDFS-11817', 'HDFS-11827', 'HDFS-11849', 'HDFS-11956', 'HDFS-119', 'HDFS-12094', 'HDFS-12339', 'HDFS-12363', 'HDFS-12369', 'HDFS-12383', 'HDFS-12498', 'HDFS-1257', 'HDFS-1258', 'HDFS-12638', 'HDFS-127', 'HDFS-12833', 'HDFS-12836', 'HDFS-12974', 'HDFS-13023', 'HDFS-13039', 'HDFS-13040', 'HDFS-13145', 'HDFS-13164', 'HDFS-13485', 'HDFS-13635', 'HDFS-13721', 'HDFS-13731', 'HDFS-13772', 'HDFS-13836', 'HDFS-142', 'HDFS-192', 'HDFS-1981', 'HDFS-2011', 'HDFS-2053', 'HDFS-2229', 'HDFS-2240', 'HDFS-2245', 'HDFS-2271', 'HDFS-2298', 'HDFS-2310', 'HDFS-2359', 'HDFS-2392', 'HDFS-2422', 'HDFS-2436', 'HDFS-2452', 'HDFS-2484', 'HDFS-2700', 'HDFS-2757', 'HDFS-2827', 'HDFS-2882', 'HDFS-2914', 'HDFS-2991', 'HDFS-2994', 'HDFS-3048', 'HDFS-3070', 'HDFS-3100', 'HDFS-3157', 'HDFS-3194', 'HDFS-3326', 'HDFS-3328', 'HDFS-3332', 'HDFS-3374', 'HDFS-3384', 'HDFS-3385', 'HDFS-3391', 'HDFS-3398', 'HDFS-3415', 'HDFS-3436', 'HDFS-3443', 'HDFS-3540', 'HDFS-3555', 'HDFS-3577', 'HDFS-3597', 'HDFS-3625', 'HDFS-3626', 'HDFS-3664', 'HDFS-3731', 'HDFS-3828', 'HDFS-3875', 'HDFS-3919', 'HDFS-3936', 'HDFS-4006', 'HDFS-4128', 'HDFS-4138', 'HDFS-4201', 'HDFS-4205', 'HDFS-4210', 'HDFS-4302', 'HDFS-4315', 'HDFS-4341', 'HDFS-4376', 'HDFS-4404', 'HDFS-4426', 'HDFS-4458', 'HDFS-4544', 'HDFS-4558', 'HDFS-456', 'HDFS-4660', 'HDFS-4799', 'HDFS-4813', 'HDFS-4816', 'HDFS-4840', 'HDFS-4841', 'HDFS-4845', 'HDFS-4846', 'HDFS-4850', 'HDFS-4867', 'HDFS-4882', 'HDFS-4927', 'HDFS-4943', 'HDFS-5014', 'HDFS-5042', 'HDFS-5074', 'HDFS-5140', 'HDFS-5159', 'HDFS-5185', 'HDFS-525', 'HDFS-5291', 'HDFS-5322', 'HDFS-5425', 'HDFS-5428', 'HDFS-5526', 'HDFS-5562', 'HDFS-5657', 'HDFS-5671', 'HDFS-5710', 'HDFS-5723', 'HDFS-5728', 'HDFS-5747', 'HDFS-5828', 'HDFS-5843', 'HDFS-5982', 'HDFS-6102', 'HDFS-611', 'HDFS-6130', 'HDFS-6178', 'HDFS-6227', 'HDFS-6245', 'HDFS-6250', 'HDFS-6289', 'HDFS-6348', 'HDFS-6455', 'HDFS-6462', 'HDFS-6481', 'HDFS-6520', 'HDFS-6527', 'HDFS-6533', 'HDFS-6563', 'HDFS-6569', 'HDFS-6715', 'HDFS-6753', 'HDFS-6763', 'HDFS-6797', 'HDFS-6799', 'HDFS-6804', 'HDFS-6822', 'HDFS-6823', 'HDFS-6825', 'HDFS-6833', 'HDFS-686', 'HDFS-6904', 'HDFS-7180', 'HDFS-7208', 'HDFS-7258', 'HDFS-7305', 'HDFS-732', 'HDFS-7358', 'HDFS-7401', 'HDFS-7496', 'HDFS-7503', 'HDFS-761', 'HDFS-762', 'HDFS-7884', 'HDFS-7886', 'HDFS-7915', 'HDFS-7916', 'HDFS-792', 'HDFS-7930', 'HDFS-7996', 'HDFS-8055', 'HDFS-8070', 'HDFS-8113', 'HDFS-8173', 'HDFS-8229', 'HDFS-8268', 'HDFS-8276', 'HDFS-833', 'HDFS-8791', 'HDFS-8807', 'HDFS-8897', 'HDFS-8995', 'HDFS-909', 'HDFS-9249', 'HDFS-9478', 'HDFS-9549', 'HDFS-9624', 'HIVE-10010', 'HIVE-10083', 'HIVE-10098', 'HIVE-10151', 'HIVE-10226', 'HIVE-10242', 'HIVE-10288', 'HIVE-10528', 'HIVE-10538', 'HIVE-10559', 'HIVE-10690', 'HIVE-10727', 'HIVE-10736', 'HIVE-10746', 'HIVE-10776', 'HIVE-10801', 'HIVE-10808', 'HIVE-10816', 'HIVE-10829', 'HIVE-10940', 'HIVE-10992', 'HIVE-11028', 'HIVE-11031', 'HIVE-11062', 'HIVE-11102', 'HIVE-11215', 'HIVE-11255', 'HIVE-11285', 'HIVE-11301', 'HIVE-11303', 'HIVE-11369', 'HIVE-11428', 'HIVE-11441', 'HIVE-11466', 'HIVE-11470', 'HIVE-11540', 'HIVE-11657', 'HIVE-11762', 'HIVE-11786', 'HIVE-11820', 'HIVE-11902', 'HIVE-11928', 'HIVE-11991', 'HIVE-12008', 'HIVE-12083', 'HIVE-12206', 'HIVE-12360', 'HIVE-12364', 'HIVE-12476', 'HIVE-12522', 'HIVE-12567', 'HIVE-12608', 'HIVE-12790', 'HIVE-13017', 'HIVE-13065', 'HIVE-13090', 'HIVE-13115', 'HIVE-13160', 'HIVE-13174', 'HIVE-13209', 'HIVE-13237', 'HIVE-1326', 'HIVE-13383', 'HIVE-13392', 'HIVE-13527', 'HIVE-13546', 'HIVE-13657', 'HIVE-13691', 'HIVE-13836', 'HIVE-13856', 'HIVE-14301', 'HIVE-14303', 'HIVE-14380', 'HIVE-14564', 'HIVE-14714', 'HIVE-14784', 'HIVE-14898', 'HIVE-15309', 'HIVE-1538', 'HIVE-1547', 'HIVE-15686', 'HIVE-15755', 'HIVE-15778', 'HIVE-15997', 'HIVE-16450', 'HIVE-16487', 'HIVE-1678', 'HIVE-16845', 'HIVE-1712', 'HIVE-1720', 'HIVE-17274', 'HIVE-17368', 'HIVE-17758', 'HIVE-17774', 'HIVE-17900', 'HIVE-18429', 'HIVE-18918', 'HIVE-19085', 'HIVE-19130', 'HIVE-19248', 'HIVE-2031', 'HIVE-21028', 'HIVE-230', 'HIVE-2372', 'HIVE-251', 'HIVE-2532', 'HIVE-2540', 'HIVE-2958', 'HIVE-308', 'HIVE-3205', 'HIVE-3493', 'HIVE-3495', 'HIVE-3651', 'HIVE-4009', 'HIVE-400', 'HIVE-4018', 'HIVE-4216', 'HIVE-4233', 'HIVE-4403', 'HIVE-4502', 'HIVE-4619', 'HIVE-4723', 'HIVE-4730', 'HIVE-4733', 'HIVE-4975', 'HIVE-4996', 'HIVE-5084', 'HIVE-5199', 'HIVE-5428', 'HIVE-5431', 'HIVE-547', 'HIVE-5546', 'HIVE-5559', 'HIVE-5648', 'HIVE-5664', 'HIVE-5857', 'HIVE-5899', 'HIVE-6113', 'HIVE-6205', 'HIVE-6301', 'HIVE-6309', 'HIVE-6389', 'HIVE-6537', 'HIVE-6538', 'HIVE-6915', 'HIVE-6984', 'HIVE-6990', 'HIVE-7009', 'HIVE-7049', 'HIVE-7114', 'HIVE-7167', 'HIVE-718', 'HIVE-7232', 'HIVE-7249', 'HIVE-7351', 'HIVE-7374', 'HIVE-7396', 'HIVE-7557', 'HIVE-7623', 'HIVE-7710', 'HIVE-7745', 'HIVE-7763', 'HIVE-7799', 'HIVE-7803', 'HIVE-7950', 'HIVE-8008', 'HIVE-8107', 'HIVE-8280', 'HIVE-8295', 'HIVE-8315', 'HIVE-8386', 'HIVE-84', 'HIVE-8545', 'HIVE-8735', 'HIVE-8765', 'HIVE-8766', 'HIVE-8771', 'HIVE-8850', 'HIVE-8915', 'HIVE-8916', 'HIVE-8966', 'HIVE-9055', 'HIVE-9141', 'HIVE-9195', 'HIVE-9390', 'HIVE-9513', 'HIVE-9570', 'HIVE-9647', 'HIVE-9655', 'HIVE-9706', 'HIVE-9721', 'HIVE-9755', 'HIVE-9873', 'HIVE-9934', 'HIVE-9976', 'MAPREDUCE-1171', 'MAPREDUCE-1186', 'MAPREDUCE-1538', 'MAPREDUCE-1543', 'MAPREDUCE-1700', 'MAPREDUCE-2238', 'MAPREDUCE-2450', 'MAPREDUCE-2451', 'MAPREDUCE-2463', 'MAPREDUCE-2529', 'MAPREDUCE-2555', 'MAPREDUCE-2667', 'MAPREDUCE-2687', 'MAPREDUCE-2716', 'MAPREDUCE-2735', 'MAPREDUCE-2907', 'MAPREDUCE-2932', 'MAPREDUCE-2963', 'MAPREDUCE-3005', 'MAPREDUCE-3030', 'MAPREDUCE-3053', 'MAPREDUCE-3056', 'MAPREDUCE-3058', 'MAPREDUCE-3062', 'MAPREDUCE-3066', 'MAPREDUCE-3070', 'MAPREDUCE-3123', 'MAPREDUCE-3124', 'MAPREDUCE-3176', 'MAPREDUCE-3186', 'MAPREDUCE-3226', 'MAPREDUCE-3241', 'MAPREDUCE-3274', 'MAPREDUCE-3306', 'MAPREDUCE-3319', 'MAPREDUCE-3333', 'MAPREDUCE-3345', 'MAPREDUCE-3463', 'MAPREDUCE-3484', 'MAPREDUCE-3531', 'MAPREDUCE-3532', 'MAPREDUCE-3583', 'MAPREDUCE-3596', 'MAPREDUCE-3615', 'MAPREDUCE-3649', 'MAPREDUCE-3656', 'MAPREDUCE-3706', 'MAPREDUCE-3714', 'MAPREDUCE-3728', 'MAPREDUCE-3738', 'MAPREDUCE-3744', 'MAPREDUCE-3746', 'MAPREDUCE-3748', 'MAPREDUCE-3790', 'MAPREDUCE-3889', 'MAPREDUCE-3931', 'MAPREDUCE-3932', 'MAPREDUCE-3952', 'MAPREDUCE-4003', 'MAPREDUCE-4008', 'MAPREDUCE-4012', 'MAPREDUCE-4048', 'MAPREDUCE-4062', 'MAPREDUCE-4102', 'MAPREDUCE-4129', 'MAPREDUCE-4144', 'MAPREDUCE-4152', 'MAPREDUCE-4156', 'MAPREDUCE-4164', 'MAPREDUCE-4252', 'MAPREDUCE-4262', 'MAPREDUCE-4295', 'MAPREDUCE-4299', 'MAPREDUCE-4300', 'MAPREDUCE-430', 'MAPREDUCE-4376', 'MAPREDUCE-4437', 'MAPREDUCE-4448', 'MAPREDUCE-4451', 'MAPREDUCE-4457', 'MAPREDUCE-4463', 'MAPREDUCE-4467', 'MAPREDUCE-4490', 'MAPREDUCE-4637', 'MAPREDUCE-4646', 'MAPREDUCE-4729', 'MAPREDUCE-4741', 'MAPREDUCE-4748', 'MAPREDUCE-4774', 'MAPREDUCE-4794', 'MAPREDUCE-4825', 'MAPREDUCE-4843', 'MAPREDUCE-4848', 'MAPREDUCE-4890', 'MAPREDUCE-4913', 'MAPREDUCE-4927', 'MAPREDUCE-4938', 'MAPREDUCE-5028', 'MAPREDUCE-5088', 'MAPREDUCE-5137', 'MAPREDUCE-5169', 'MAPREDUCE-5198', 'MAPREDUCE-5251', 'MAPREDUCE-5260', 'MAPREDUCE-5261', 'MAPREDUCE-5349', 'MAPREDUCE-5358', 'MAPREDUCE-5451', 'MAPREDUCE-5470', 'MAPREDUCE-5724', 'MAPREDUCE-5744', 'MAPREDUCE-5756', 'MAPREDUCE-5763', 'MAPREDUCE-5778', 'MAPREDUCE-5805', 'MAPREDUCE-5837', 'MAPREDUCE-5884', 'MAPREDUCE-5912', 'MAPREDUCE-5924', 'MAPREDUCE-5931', 'MAPREDUCE-5952', 'MAPREDUCE-6002', 'MAPREDUCE-6068', 'MAPREDUCE-6091', 'MAPREDUCE-6166', 'MAPREDUCE-6213', 'MAPREDUCE-6238', 'MAPREDUCE-6242', 'MAPREDUCE-6259', 'MAPREDUCE-6261', 'MAPREDUCE-6273', 'MAPREDUCE-6293', 'MAPREDUCE-6302', 'MAPREDUCE-6303', 'MAPREDUCE-6338', 'MAPREDUCE-6343', 'MAPREDUCE-6353', 'MAPREDUCE-6357', 'MAPREDUCE-6361', 'MAPREDUCE-6410', 'MAPREDUCE-6439', 'MAPREDUCE-6452', 'MAPREDUCE-6485', 'MAPREDUCE-6492', 'MAPREDUCE-6513', 'MAPREDUCE-6514', 'MAPREDUCE-6525', 'MAPREDUCE-6554', 'MAPREDUCE-6577', 'MAPREDUCE-6633', 'MAPREDUCE-6649', 'MAPREDUCE-6693', 'MAPREDUCE-6702', 'MAPREDUCE-6762', 'MAPREDUCE-6815', 'MAPREDUCE-6836', 'MAPREDUCE-6895', 'MAPREDUCE-6910', 'MAPREDUCE-7028', 'MAPREDUCE-7059', 'MAPREDUCE-7077', 'MAPREDUCE-805', 'MAPREDUCE-834', 'MAPREDUCE-838', 'MAPREDUCE-899', 'MAPREDUCE-964', 'STORM-1114', 'STORM-1520', 'STORM-1540', 'STORM-1545', 'STORM-1596', 'STORM-1642', 'STORM-1663', 'STORM-1666', 'STORM-1672', 'STORM-1941', 'STORM-1977', 'STORM-2095', 'STORM-2142', 'STORM-2158', 'STORM-2194', 'STORM-2197', 'STORM-2231', 'STORM-2275', 'STORM-2279', 'STORM-2321', 'STORM-2324', 'STORM-2400', 'STORM-2443', 'STORM-2496', 'STORM-2518', 'STORM-2568', 'STORM-2666', 'STORM-2675', 'STORM-2682', 'STORM-2700', 'STORM-2736', 'STORM-2809', 'STORM-2811', 'STORM-2820', 'STORM-2829', 'STORM-2847', 'STORM-2873', 'STORM-2879', 'STORM-2903', 'STORM-2912', 'STORM-2986', 'STORM-2987', 'STORM-2988', 'STORM-2993', 'STORM-3012', 'STORM-3013', 'STORM-3055', 'STORM-3073', 'STORM-3079', 'STORM-3082', 'STORM-3084', 'STORM-3096', 'STORM-3103', 'STORM-3117', 'STORM-3118', 'STORM-3124', 'STORM-3158', 'STORM-3168', 'STORM-3184', 'STORM-3208', 'STORM-3213', 'YARN-1022', 'YARN-1032', 'YARN-1046', 'YARN-1094', 'YARN-1149', 'YARN-1273', 'YARN-1278', 'YARN-1284', 'YARN-1374', 'YARN-139', 'YARN-1409', 'YARN-1416', 'YARN-1438', 'YARN-1458', 'YARN-1550', 'YARN-1591', 'YARN-1661', 'YARN-1678', 'YARN-1689', 'YARN-1692', 'YARN-1724', 'YARN-174', 'YARN-1752', 'YARN-1785', 'YARN-180', 'YARN-1839', 'YARN-1852', 'YARN-1866', 'YARN-1903', 'YARN-1919', 'YARN-192', 'YARN-196', 'YARN-2010', 'YARN-2124', 'YARN-2273', 'YARN-22', 'YARN-2308', 'YARN-2340', 'YARN-2409', 'YARN-2414', 'YARN-2416', 'YARN-2459', 'YARN-24', 'YARN-251', 'YARN-253', 'YARN-2559', 'YARN-2563', 'YARN-2565', 'YARN-2594', 'YARN-2602', 'YARN-2612', 'YARN-2617', 'YARN-2649', 'YARN-271', 'YARN-272', 'YARN-2742', 'YARN-2743', 'YARN-2790', 'YARN-2803', 'YARN-2805', 'YARN-2813', 'YARN-2823', 'YARN-2834', 'YARN-2846', 'YARN-2857', 'YARN-2859', 'YARN-2865', 'YARN-2910', 'YARN-2917', 'YARN-2931', 'YARN-301', 'YARN-3082', 'YARN-3102', 'YARN-3197', 'YARN-319', 'YARN-3222', 'YARN-3227', 'YARN-3242', 'YARN-3260', 'YARN-3351', 'YARN-335', 'YARN-3369', 'YARN-3375', 'YARN-3425', 'YARN-345', 'YARN-3493', 'YARN-3495', 'YARN-3535', 'YARN-3537', 'YARN-3585', 'YARN-3629', 'YARN-3641', 'YARN-3675', 'YARN-3697', 'YARN-370', 'YARN-3733', 'YARN-3742', 'YARN-3749', 'YARN-3790', 'YARN-3793', 'YARN-3804', 'YARN-3809', 'YARN-3832', 'YARN-383', 'YARN-3842', 'YARN-3859', 'YARN-3878', 'YARN-3894', 'YARN-3896', 'YARN-3917', 'YARN-3919', 'YARN-3963', 'YARN-3971', 'YARN-4000', 'YARN-4106', 'YARN-4109', 'YARN-4152', 'YARN-4167', 'YARN-4227', 'YARN-4235', 'YARN-4288', 'YARN-42', 'YARN-4308', 'YARN-4325', 'YARN-4344', 'YARN-4347', 'YARN-4392', 'YARN-4424', 'YARN-4431', 'YARN-4452', 'YARN-4454', 'YARN-4497', 'YARN-4520', 'YARN-4530', 'YARN-4581', 'YARN-4584', 'YARN-4598', 'YARN-4709', 'YARN-4743', 'YARN-4744', 'YARN-4762', 'YARN-4763', 'YARN-476', 'YARN-4831', 'YARN-4833', 'YARN-4882', 'YARN-4976', 'YARN-4984', 'YARN-5006', 'YARN-5098', 'YARN-5112', 'YARN-5136', 'YARN-5382', 'YARN-541', 'YARN-5545', 'YARN-5594', 'YARN-5725', 'YARN-5728', 'YARN-5837', 'YARN-5873', 'YARN-5918', 'YARN-5988', 'YARN-6031', 'YARN-6054', 'YARN-6068', 'YARN-6072', 'YARN-6082', 'YARN-6102', 'YARN-6166', 'YARN-6175', 'YARN-63', 'YARN-6433', 'YARN-6448', 'YARN-6534', 'YARN-6629', 'YARN-6647', 'YARN-6649', 'YARN-6683', 'YARN-6714', 'YARN-6827', 'YARN-6837', 'YARN-6870', 'YARN-68', 'YARN-6920', 'YARN-6948', 'YARN-6959', 'YARN-7102', 'YARN-7118', 'YARN-7163', 'YARN-7249', 'YARN-7269', 'YARN-7382', 'YARN-7453', 'YARN-7511', 'YARN-7607', 'YARN-7645', 'YARN-7663', 'YARN-7692', 'YARN-7697', 'YARN-7727', 'YARN-7737', 'YARN-7765', 'YARN-7786', 'YARN-7818', 'YARN-7835', 'YARN-7849', 'YARN-7879', 'YARN-7890', 'YARN-7942', 'YARN-7962', 'YARN-7984', 'YARN-8022', 'YARN-8035', 'YARN-8108', 'YARN-8116', 'YARN-8202', 'YARN-8209', 'YARN-8211', 'YARN-8223', 'YARN-8236', 'YARN-8292', 'YARN-8316', 'YARN-8326', 'YARN-8330', 'YARN-8331', 'YARN-8346', 'YARN-8357', 'YARN-8403', 'YARN-8409', 'YARN-8418', 'YARN-8508', 'YARN-8512', 'YARN-8591', 'YARN-8610', 'YARN-8629', 'YARN-8649', 'YARN-874', 'YARN-903', 'YARN-933', 'YARN-945', 'YARN-960', 'ZOOKEEPER-1154', 'ZOOKEEPER-1179', 'ZOOKEEPER-1264', 'ZOOKEEPER-1270', 'ZOOKEEPER-1271', 'ZOOKEEPER-1340', 'ZOOKEEPER-1427', 'ZOOKEEPER-1496', 'ZOOKEEPER-1560', 'ZOOKEEPER-1629', 'ZOOKEEPER-1633', 'ZOOKEEPER-1732', 'ZOOKEEPER-1781', 'ZOOKEEPER-1840', 'ZOOKEEPER-1844', 'ZOOKEEPER-1864', 'ZOOKEEPER-1870', 'ZOOKEEPER-1894', 'ZOOKEEPER-1898', 'ZOOKEEPER-2044', 'ZOOKEEPER-2052', 'ZOOKEEPER-2172', 'ZOOKEEPER-2193', 'ZOOKEEPER-2213', 'ZOOKEEPER-2227', 'ZOOKEEPER-2247', 'ZOOKEEPER-2297', 'ZOOKEEPER-2355', 'ZOOKEEPER-2383', 'ZOOKEEPER-2405', 'ZOOKEEPER-2539', 'ZOOKEEPER-2581', 'ZOOKEEPER-2712', 'ZOOKEEPER-2808', 'ZOOKEEPER-2959', 'ZOOKEEPER-2982', 'ZOOKEEPER-706', 'ZOOKEEPER-880']


    # Get bug reports with stack traces
    bug_reports = get_bug_reports_with_stack_traces(REPO_PATH, excluded_folders, filename_list)

    if bug_reports:
        print(f"Found {len(bug_reports)} JSON files with stack traces meeting criteria.")

        # Save the results to a text file
        with open("bug_reports_with_stack_traces.json", "w", encoding='utf-8') as f:
            json.dump(bug_reports, f, indent=4)
            # for report in bug_reports:
            #     f.write(f"{report['filename']} - {report['path']}\n")
        
        print("Bug reports with stack traces saved to 'bug_reports_with_stack_traces.json'.")
    else:
        print('No JSON files with stack traces found.')

if __name__ == '__main__':
    main()