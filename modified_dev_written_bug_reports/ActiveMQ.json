[
    {
        "filename": "AMQ-6548.json",
        "creation_time": "2016-12-21T12:04:12.000+0000",
        "bug_report": {
            "Title": "Commit messages on exception",
            "Description": "At ear stop jsm connection consumes messages, although there occured exception\n{noformat}\n2016-12-15 16:12:58,831 ERROR [org.jboss.as.ejb3.invocation.processInvocation] (default-threads - 23) WFLYEJB0034: EJB Invocation failed on component test.test.mdb for method public void test.test.onMessage(javax.jms.Message): org.jboss.as.ejb3.component.EJBComponentUnavailableException: WFLYEJB0421: Invocation cannot proceed as component is shutting down\n        at org.jboss.as.ejb3.component.interceptors.ShutDownInterceptorFactory$1.processInvocation(ShutDownInterceptorFactory.java:59)\n        at org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:340)\n        at org.jboss.as.ejb3.deployment.processors.EjbSuspendInterceptor.processInvocation(EjbSuspendInterceptor.java:53)\n        at org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:340)\n        at org.jboss.as.ejb3.component.interceptors.LoggingInterceptor.processInvocation(LoggingInterceptor.java:66)\n        at org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:340)\n        at org.jboss.as.ee.component.NamespaceContextInterceptor.processInvocation(NamespaceContextInterceptor.java:50)\n        at org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:340)\n        at org.jboss.as.ejb3.component.interceptors.AdditionalSetupInterceptor.processInvocation(AdditionalSetupInterceptor.java:54)\n        at org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:340)\n        at org.jboss.as.ejb3.component.messagedriven.MessageDrivenComponentDescription$5$1.processInvocation(MessageDrivenComponentDescription.java:213)\n        at org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:340)\n        at org.jboss.invocation.ContextClassLoaderInterceptor.processInvocation(ContextClassLoaderInterceptor.java:64)\n        at org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:340)\n        at org.jboss.invocation.InterceptorContext.run(InterceptorContext.java:356)\n        at org.wildfly.security.manager.WildFlySecurityManager.doChecked(WildFlySecurityManager.java:634)\n        at org.jboss.invocation.AccessCheckingInterceptor.processInvocation(AccessCheckingInterceptor.java:61)\n        at org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:340)\n        at org.jboss.invocation.InterceptorContext.run(InterceptorContext.java:356)\n        at org.jboss.invocation.PrivilegedWithCombinerInterceptor.processInvocation(PrivilegedWithCombinerInterceptor.java:80)\n        at org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:340)\n        at org.jboss.invocation.ChainedInterceptor.processInvocation(ChainedInterceptor.java:61)\n        at org.jboss.as.ee.component.ViewService$View.invoke(ViewService.java:195)\n        at org.jboss.as.ee.component.ViewDescription$1.processInvocation(ViewDescription.java:185)\n        at org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:340)\n        at org.jboss.invocation.ChainedInterceptor.processInvocation(ChainedInterceptor.java:61)\n        at org.jboss.as.ee.component.ProxyInvocationHandler.invoke(ProxyInvocationHandler.java:73)\n        at test.test$$$view19.onMessage(Unknown Source)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at org.jboss.as.ejb3.inflow.MessageEndpointInvocationHandler.doInvoke(MessageEndpointInvocationHandler.java:139)\n        at org.jboss.as.ejb3.inflow.AbstractInvocationHandler.invoke(AbstractInvocationHandler.java:73)\n        at test.test$$$endpoint12.onMessage(Unknown Source)\n        at org.apache.activemq.ra.MessageEndpointProxy$MessageEndpointAlive.onMessage(MessageEndpointProxy.java:123)\n        at org.apache.activemq.ra.MessageEndpointProxy.onMessage(MessageEndpointProxy.java:64)\n        at org.apache.activemq.ActiveMQSession.run(ActiveMQSession.java:1041)\n        at org.apache.activemq.ra.ServerSessionImpl.run(ServerSessionImpl.java:169)\n        at org.jboss.jca.core.workmanager.WorkWrapper.run(WorkWrapper.java:226)\n        at org.jboss.threads.SimpleDirectExecutor.execute(SimpleDirectExecutor.java:33)\n        at org.jboss.threads.QueueExecutor.runTask(QueueExecutor.java:808)\n        at org.jboss.threads.QueueExecutor.access$100(QueueExecutor.java:45)\n        at org.jboss.threads.QueueExecutor$Worker.run(QueueExecutor.java:828)\n        at java.lang.Thread.run(Thread.java:745)\n        at org.jboss.threads.JBossThread.run(JBossThread.java:320)\n{noformat}",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-3434.json",
        "creation_time": "2011-08-03T09:15:05.000+0000",
        "bug_report": {
            "Title": "Contention in PLIist  creation results in NPE on load - FilePendingMessageCursor",
            "Description": "Ocassional ocurrance of stack trace{code}2011-06-30 16:02:09,903 [127.0.0.1:50524] ERROR FilePendingMessageCursor       - Caught an IO Exception getting the DiskList 98_PendingCursor:loadq-3\njava.lang.NullPointerException\n\tat org.apache.kahadb.index.ListIndex.loadNode(ListIndex.java:203)\n\tat org.apache.kahadb.index.ListIndex.load(ListIndex.java:75)\n\tat org.apache.activemq.store.kahadb.plist.PListStore$1.execute(PListStore.java:219)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:729)\n\tat org.apache.activemq.store.kahadb.plist.PListStore.getPList(PListStore.java:216)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.getDiskList(FilePendingMessageCursor.java:454)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.flushToDisk(FilePendingMessageCursor.java:432)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.tryAddMessageLast(FilePendingMessageCursor.java:217)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.addMessageLast(FilePendingMessageCursor.java:193)\n\tat org.apache.activemq.broker.region.Queue.sendMessage(Queue.java:1629)\n\tat org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:720)\n\tat org.apache.activemq.broker.region.Queue.send(Queue.java:652)\n\tat org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:379)\n\tat org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:523)\n\tat org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)\n\tat org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n\tat org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:304)\n\tat org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)\n\tat org.apache.activemq.broker.UserIDBroker.send(UserIDBroker.java:56)\n\tat org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:135)\n\tat org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:468)\n\tat org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:681)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:316)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:180)\n\tat org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)\n\tat org.apache.activemq.transport.stomp.StompTransportFilter.sendToActiveMQ(StompTransportFilter.java:81)\n\tat org.apache.activemq.transport.stomp.ProtocolConverter.sendToActiveMQ(ProtocolConverter.java:140)\n\tat org.apache.activemq.transport.stomp.ProtocolConverter.onStompSend(ProtocolConverter.java:257)\n\tat org.apache.activemq.transport.stomp.ProtocolConverter.onStompCommand(ProtocolConverter.java:178)\n\tat org.apache.activemq.transport.stomp.StompTransportFilter.onCommand(StompTransportFilter.java:70)\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:221)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:203)\n\tat java.lang.Thread.run(Thread.java:662)\n2011-06-30 16:02:09,912 [127.0.0.1:50524] ERROR FilePendingMessageCursor       - Caught an Exception adding a message: ActiveMQBytesMessage {commandId = 19796,\n responseRequired = false, messageId = ID:bigmacli-40948-1309463846336-2:105:-1:1:19794, originalDestination = null, originalTransactionId = null, producerId = ID:bigmacli-\n40948-1309463846336-2:105:-1:1, destination = queue://loadq-3, transactionId = null, expiration = 0, timestamp = 1309464129898, arrival = 0, brokerInTime = 1309464129898, \nbrokerOutTime = 0, correlationId = null, replyTo = null, persistent = false, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, \nuserID = null, content = org.apache.activemq.util.ByteSequence@665e2517, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 0, properties = null, \nreadOnlyProperties = true, readOnlyBody = true, droppable = false} ActiveMQBytesMessage{ bytesOut = null, dataOut = null, dataIn = null } first to FilePendingMessageCursor \n\njava.lang.RuntimeException: java.lang.NullPointerException\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.getDiskList(FilePendingMessageCursor.java:457)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.flushToDisk(FilePendingMessageCursor.java:432)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.tryAddMessageLast(FilePendingMessageCursor.java:217)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.addMessageLast(FilePendingMessageCursor.java:193)\n\tat org.apache.activemq.broker.region.Queue.sendMessage(Queue.java:1629)\n\tat org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:720)\n\tat org.apache.activemq.broker.region.Queue.send(Queue.java:652)\n\tat org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:379)\n\tat org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:523)\n\tat org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)\n\tat org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n\tat org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:304)\n\tat org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)\n\tat org.apache.activemq.broker.UserIDBroker.send(UserIDBroker.java:56)\n\tat org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:135)\n\tat org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:468)\n\tat org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:681)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:316)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:180)\n\tat org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)\n\tat org.apache.activemq.transport.stomp.StompTransportFilter.sendToActiveMQ(StompTransportFilter.java:81)\n\tat org.apache.activemq.transport.stomp.ProtocolConverter.sendToActiveMQ(ProtocolConverter.java:140)\n\tat org.apache.activemq.transport.stomp.ProtocolConverter.onStompSend(ProtocolConverter.java:257)\n\tat org.apache.activemq.transport.stomp.ProtocolConverter.onStompCommand(ProtocolConverter.java:178)\n\tat org.apache.activemq.transport.stomp.StompTransportFilter.onCommand(StompTransportFilter.java:70)\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:221)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:203)\n\tat java.lang.Thread.run(Thread.java:662)\nCaused by: java.lang.NullPointerException\n\tat org.apache.kahadb.index.ListIndex.loadNode(ListIndex.java:203)\n\tat org.apache.kahadb.index.ListIndex.load(ListIndex.java:75)\n\tat org.apache.activemq.store.kahadb.plist.PListStore$1.execute(PListStore.java:219)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:729)\n\tat org.apache.activemq.store.kahadb.plist.PListStore.getPList(PListStore.java:216)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.getDiskList(FilePendingMessageCursor.java:454)\n\t... 28 more\n\n \n\n2011-06-30 16:02:44,121 [Queue:loadq-9  ] ERROR Queue                          - Failed to page in more queue messages \njava.util.NoSuchElementException: Chunk stream does not exist, page: 63122 is marked free\n\tat org.apache.kahadb.index.ListNode$ListIterator.nextFromNextListNode(ListNode.java:149)\n\tat org.apache.kahadb.index.ListNode$ListIterator.hasNext(ListNode.java:160)\n\tat org.apache.activemq.store.kahadb.plist.PList$PListIterator.hasNext(PList.java:203)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor$DiskIterator.hasNext(FilePendingMessageCursor.java:496)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.hasNext(FilePendingMessageCursor.java:288)\n\tat org.apache.activemq.broker.region.Queue.doPageInForDispatch(Queue.java:1725)\n\tat org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1944)\n\tat org.apache.activemq.broker.region.Queue.iterate(Queue.java:1452)\n\tat org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)\n\tat org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)\nCaused by: java.io.EOFException: Chunk stream does not exist, page: 63122 is marked free\n\tat org.apache.kahadb.page.Transaction$2.readPage(Transaction.java:456)\n\tat org.apache.kahadb.page.Transaction$2.<init>(Transaction.java:433)\n\tat org.apache.kahadb.page.Transaction.openInputStream(Transaction.java:430)\n\tat org.apache.kahadb.page.Transaction.load(Transaction.java:406)\n\tat org.apache.kahadb.page.Transaction.load(Transaction.java:363)\n\tat org.apache.kahadb.index.ListIndex.loadNode(ListIndex.java:201)\n\tat org.apache.kahadb.index.ListNode$ListIterator.nextFromNextListNode(ListNode.java:147)\n\t... 9 more\n\n \n\n2011-06-30 16:02:49,401 [Queue:loadq-4  ] ERROR Queue                          - Failed to page in more queue messages \njava.util.NoSuchElementException: Could not locate data file /lab/activemq-5.5.0-fuse-00-27/data/broker/tmp_storage/db-3.log\n\tat org.apache.activemq.store.kahadb.plist.PList$PListIterator.next(PList.java:213)\n\tat org.apache.activemq.store.kahadb.plist.PList$PListIterator.next(PList.java:192)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor$DiskIterator.next(FilePendingMessageCursor.java:501)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor$DiskIterator.next(FilePendingMessageCursor.java:485)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.next(FilePendingMessageCursor.java:296)\n\tat org.apache.activemq.broker.region.Queue.doPageInForDispatch(Queue.java:1726)\n\tat org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1944)\n\tat org.apache.activemq.broker.region.Queue.iterate(Queue.java:1452)\n\tat org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)\n\tat org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)\nCaused by: java.io.IOException: Could not locate data file /lab/activemq-5.5.0-fuse-00-27/data/broker/tmp_storage/db-3.log\n\tat org.apache.kahadb.journal.Journal.getDataFile(Journal.java:350)\n\tat org.apache.kahadb.journal.Journal.read(Journal.java:597)\n\tat org.apache.activemq.store.kahadb.plist.PListStore.getPayload(PListStore.java:367)\n\tat org.apache.activemq.store.kahadb.plist.PList$PListIterator.next(PList.java:211)\n\t... 9 more{code}",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-3443.json",
        "creation_time": "2011-08-09T17:46:14.000+0000",
        "bug_report": {
            "Title": "checkpoint contention with large transaction write using temp file",
            "Description": "Unit test failure intermittently: \n org.apache.activemq.bugs \u00bb AMQ2149KahaDBTest \u00bb testQueueTransactionalOrderWithRestart\n\n{code}2011-08-09 05:25:21,468 [eckpoint Worker] - ERROR MessageDatabase                - Checkpoint failed\njava.io.IOException: Cannot create recovery file. Reason: java.io.FileNotFoundException: target/testQueueTransactionalOrderWithRestart/testQueueTransactionalOrderWithRestart/KahaDB/tx-7648-1312867516460.tmp (No such file or directory)\n\tat org.apache.kahadb.util.IOExceptionSupport.create(IOExceptionSupport.java:27)\n\tat org.apache.kahadb.page.PageFile.writeBatch(PageFile.java:1002)\n\tat org.apache.kahadb.page.PageFile.flush(PageFile.java:482)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1167)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$10.execute(MessageDatabase.java:728)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:762)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointCleanup(MessageDatabase.java:726)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointCleanup(MessageDatabase.java:714)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$3.run(MessageDatabase.java:279)\nCaused by: java.io.FileNotFoundException: target/testQueueTransactionalOrderWithRestart/testQueueTransactionalOrderWithRestart/KahaDB/tx-7648-1312867516460.tmp (No such file or directory)\n\tat java.io.RandomAccessFile.open(Native Method)\n\tat java.io.RandomAccessFile.<init>(RandomAccessFile.java:212)\n\tat org.apache.kahadb.page.PageFile$PageWrite.getDiskBound(PageFile.java:185)\n\tat org.apache.kahadb.page.PageFile.writeBatch(PageFile.java:1000)\n\t... 7 more\n2011-08-09 05:25:21,469 [eckpoint Worker] - INFO  DefaultIOExceptionHandler      - Stopping the broker due to IO exception, java.io.IOException: Cannot create recovery file. Reason: java.io.FileNotFoundException: target/testQueueTransactionalOrderWithRestart/testQueueTransactionalOrderWithRestart/KahaDB/tx-7648-1312867516460.tmp (No such file or directory)\njava.io.IOException: Cannot create recovery file. Reason: java.io.FileNotFoundException: target/testQueueTransactionalOrderWithRestart/testQueueTransactionalOrderWithRestart/KahaDB/tx-7648-1312867516460.tmp (No such file or directory)\n\tat org.apache.kahadb.util.IOExceptionSupport.create(IOExceptionSupport.java:27)\n\tat org.apache.kahadb.page.PageFile.writeBatch(PageFile.java:1002)\n\tat org.apache.kahadb.page.PageFile.flush(PageFile.java:482)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1167)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$10.execute(MessageDatabase.java:728)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:762)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointCleanup(MessageDatabase.java:726)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointCleanup(MessageDatabase.java:714)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$3.run(MessageDatabase.java:279)\nCaused by: java.io.FileNotFoundException: target/testQueueTransactionalOrderWithRestart/testQueueTransactionalOrderWithRestart/KahaDB/tx-7648-1312867516460.tmp (No such file or directory){code}",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-4369.json",
        "creation_time": "2013-03-13T13:51:31.000+0000",
        "bug_report": {
            "Title": "Default IOException handler needs to be set before Persistence adapter and network connectors are started",
            "Description": "It is possible to get an IOException before the current default handler is installed, so it is bypassed. It needs to be set earlier.\n{code}2013-03-11 09:51:24,409 | INFO  | No IOExceptionHandler registered, ignoring IO exception, java.io.IOException: Input/output error | org.apache.activemq.broker.BrokerService | ActiveMQ Transport: ssl:///xxx:yyy\njava.io.IOException: Input/output error\n\tat java.io.RandomAccessFile.readBytes(Native Method)\n\tat java.io.RandomAccessFile.read(RandomAccessFile.java:355)\n\tat java.io.RandomAccessFile.readFully(RandomAccessFile.java:414)\n\tat java.io.RandomAccessFile.readFully(RandomAccessFile.java:394)\n\tat org.apache.kahadb.page.PageFile.readPage(PageFile.java:833)\n\tat org.apache.kahadb.page.Transaction$2.readPage(Transaction.java:447)\n\tat org.apache.kahadb.page.Transaction$2.<init>(Transaction.java:438)\n\tat org.apache.kahadb.page.Transaction.openInputStream(Transaction.java:435)\n\tat org.apache.kahadb.page.Transaction.load(Transaction.java:411)\n\tat org.apache.kahadb.page.Transaction.load(Transaction.java:368)\n\tat org.apache.kahadb.index.BTreeIndex.loadNode(BTreeIndex.java:262)\n\tat org.apache.kahadb.index.BTreeIndex.getRoot(BTreeIndex.java:174)\n\tat org.apache.kahadb.index.BTreeIndex.remove(BTreeIndex.java:194)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.updateIndex(MessageDatabase.java:1212)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$15.execute(MessageDatabase.java:1028)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:771)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.process(MessageDatabase.java:1026)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$13.visit(MessageDatabase.java:961)\n\tat org.apache.activemq.store.kahadb.data.KahaRemoveMessageCommand.visit(KahaRemoveMessageCommand.java:220)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.process(MessageDatabase.java:953)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:865)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.removeMessage(KahaDBStore.java:439)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.removeAsyncMessage(KahaDBStore.java:411)\n\tat org.apache.activemq.store.kahadb.KahaDBTransactionStore.removeAsyncMessage(KahaDBTransactionStore.java:468)\n\tat org.apache.activemq.store.kahadb.KahaDBTransactionStore$1.removeAsyncMessage(KahaDBTransactionStore.java:171)\n\tat org.apache.activemq.broker.region.Queue.acknowledge(Queue.java:830)\n\tat org.apache.activemq.broker.region.Queue.removeMessage(Queue.java:1584)\n\tat org.apache.activemq.broker.region.QueueSubscription.acknowledge(QueueSubscription.java:59)\n\tat org.apache.activemq.broker.region.PrefetchSubscription.acknowledge(PrefetchSubscription.java:294)\n\tat org.apache.activemq.broker.region.AbstractRegion.acknowledge(AbstractRegion.java:426)\n\tat org.apache.activemq.broker.region.RegionBroker.acknowledge(RegionBroker.java:537)\n\tat org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:77)\n\tat org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:77)\n\tat org.apache.activemq.broker.TransactionBroker.acknowledge(TransactionBroker.java:287)\n\tat org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:77)\n\tat org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:77)\n\tat org.apache.activemq.broker.MutableBrokerFilter.acknowledge(MutableBrokerFilter.java:87)\n\tat org.apache.activemq.broker.TransportConnection.processMessageAck(TransportConnection.java:461)\n\tat org.apache.activemq.command.MessageAck.visit(MessageAck.java:236)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:292)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:150)\n\tat org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n\tat org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n\tat org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:268)\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n\tat org.apache.activemq.transport.tcp.SslTransport.doConsume(SslTransport.java:91)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:215)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:197)\n\tat java.lang.Thread.run(Thread.java:679){code}",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-5016.json",
        "creation_time": "2014-02-03T16:40:26.000+0000",
        "bug_report": {
            "Title": "BitArrayBin doesn't work well with index larger than Integer.MAX_VALUE",
            "Description": "In BitArrayBin class, the index's unit type is long. It also has a variable called firstIndex, which store the index where the window starts. And that firstindex's unit is int. If the index is bigger than Integer.MAX_VALUE, setBit() and getBit() starts to return bad value.\n\nThe defect causes activemq client to perform badly when receiving message that sequence id is bigger than max interger. It spends most of the time to shift window, and also blocks other consumer threads. Below is the jstack log that shows the problem.\n{code}\n\"ActiveMQ Session Task-869879\" prio=10 tid=0x00007f412d6ee000 nid=0x3cbe runnable [0x00007f405b7b6000]\n   java.lang.Thread.State: RUNNABLE\n        at java.util.LinkedList.linkLast(LinkedList.java:140)\n        at java.util.LinkedList.add(LinkedList.java:336)\n        at org.apache.activemq.util.BitArrayBin.getBitArray(BitArrayBin.java:123)\n        at org.apache.activemq.util.BitArrayBin.setBit(BitArrayBin.java:59)\n        at org.apache.activemq.ActiveMQMessage AuditNoSync.isDuplicate(ActiveMQMessageAuditNoSyn c.java:160)\n        at org.apache.activemq.ActiveMQMessageAudit.isDuplicate(ActiveMQMessageAudit.java:59)\n        - locked <0x00007f46a0138ab0> (a org.apache.activemq.ActiveMQMessageAudit)\n        at org.apache.activemq.ActiveMQMessage AuditNoSync.isDuplicate(ActiveMQMessageAuditNoSyn c.java:140)\n        at org.apache.activemq.ConnectionAudit.isDuplicate(ConnectionAudit.java:52)\n        - locked <0x00007f4881e6b968> (a org.apache.activemq.ConnectionAudit)\n        at org.apache.activemq.ActiveMQConnection.isDuplicate(ActiveMQConnection.java:2291)\n        at org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:1223)\n        - locked <0x00007f45db222fb8> (a java.lang.Object)\n        at org.apache.activemq.ActiveMQSessionExecutor.dispatch(ActiveMQSessionExecutor.java:134)\n        at org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:205)\n        at org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:127)\n        at org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:48)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n        at java.lang.Thread.run(Thread.java:722)\n{code}\n",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-4407.json",
        "creation_time": "2013-03-26T15:41:15.000+0000",
        "bug_report": {
            "Title": "mKahaDB: PageFile is not loaded when recreating queue",
            "Description": "Using mKahaDB, we create a queue, delete it through the admin interface, and attempt to recreate it, receiving the error below on the client. \n\n2013-03-08 10:29:17,903 | WARN  | Async error occurred: java.lang.IllegalStateException: PageFile is not loaded | org.apache.activemq.broker.TransportConnection.Service | ActiveMQ Transport: tcp:///0:0:0:0:0:0:0:1%0:65222@61613\njava.lang.IllegalStateException: PageFile is not loaded\n\tat org.apache.activemq.store.kahadb.disk.page.PageFile.assertLoaded(PageFile.java:809)\n\tat org.apache.activemq.store.kahadb.disk.page.PageFile.tx(PageFile.java:303)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.getMessageCount(KahaDBStore.java:478)\n\tat org.apache.activemq.store.ProxyMessageStore.getMessageCount(ProxyMessageStore.java:101)\n\tat org.apache.activemq.store.ProxyMessageStore.getMessageCount(ProxyMessageStore.java:101)\n\tat org.apache.activemq.broker.region.Queue.initialize(Queue.java:376)\n\tat org.apache.activemq.broker.region.DestinationFactoryImpl.createDestination(DestinationFactoryImpl.java:87)\n\tat org.apache.activemq.broker.region.AbstractRegion.createDestination(AbstractRegion.java:526)\n\tat org.apache.activemq.broker.jmx.ManagedQueueRegion.createDestination(ManagedQueueRegion.java:56)\n\tat org.apache.activemq.broker.region.AbstractRegion.addDestination(AbstractRegion.java:136)\n\tat org.apache.activemq.broker.region.RegionBroker.addDestination(RegionBroker.java:277)\n\tat org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:145)\n\tat org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:145)\n\tat org.apache.activemq.broker.MutableBrokerFilter.addDestination(MutableBrokerFilter.java:151)\n\tat org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:387)\n\tat org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:282)\n\tat org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n\tat org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:317)\n\tat org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:135)\n\tat org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:499)\n\tat org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:749)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:329)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:184)\n\tat org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:45)\n\tat org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:288)\n\tat org.apache.activemq.transport.stomp.StompTransportFilter.sendToActiveMQ(StompTransportFilter.java:84)\n\tat org.apache.activemq.transport.stomp.ProtocolConverter.sendToActiveMQ(ProtocolConverter.java:195)\n\tat org.apache.activemq.transport.stomp.ProtocolConverter.onStompSend(ProtocolConverter.java:321)\n\tat org.apache.activemq.transport.stomp.ProtocolConverter.onStompCommand(ProtocolConverter.java:233)\n\tat org.apache.activemq.transport.stomp.StompTransportFilter.onCommand(StompTransportFilter.java:73)\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n\tat java.lang.Thread.run(Thread.java:680)\n2013-03-08 10:29:17,905 | WARN  | Exception occurred processing: \nnull: java.lang.IllegalStateException: PageFile is not loaded | org.apache.activemq.transport.stomp.ProtocolConverter | ActiveMQ Connection Dispatcher: tcp://0:0:0:0:0:0:0:1%0:65222",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-4221.json",
        "creation_time": "2012-12-13T16:15:04.000+0000",
        "bug_report": {
            "Title": "NPE plist (temp) sparse removal - filependingmessagecursor with selector and expiry",
            "Description": "{code}2012-12-13 11:37:27,027 [calhost] Task-1] - ERROR Queue                          - Failed to page in more queue messages \njava.lang.NullPointerException\n\tat org.apache.kahadb.index.ListNode.access$200(ListNode.java:37)\n\tat org.apache.kahadb.index.ListNode$NodeMarshaller.writePayload(ListNode.java:265)\n\tat org.apache.kahadb.index.ListNode$NodeMarshaller.writePayload(ListNode.java:255)\n\tat org.apache.kahadb.page.Transaction.store(Transaction.java:248)\n\tat org.apache.kahadb.index.ListIndex.storeNode(ListIndex.java:326)\n\tat org.apache.kahadb.index.ListNode.store(ListNode.java:332)\n\tat org.apache.kahadb.index.ListNode.access$500(ListNode.java:37)\n\tat org.apache.kahadb.index.ListNode$ListIterator.remove(ListNode.java:227)\n\tat org.apache.activemq.store.kahadb.plist.PList$PListIterator$1.execute(PList.java:229)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:771)\n\tat org.apache.activemq.store.kahadb.plist.PList$PListIterator.remove(PList.java:226)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor$DiskIterator.remove(FilePendingMessageCursor.java:517)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.remove(FilePendingMessageCursor.java:321)\n\tat org.apache.activemq.broker.region.Queue.doPageInForDispatch(Queue.java:1735)\n\tat org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1948)\n\tat org.apache.activemq.broker.region.Queue.iterate(Queue.java:1465)\n\tat org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:122)\n\tat org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:43)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:680)\n{code}",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-3622.json",
        "creation_time": "2011-12-06T15:16:49.000+0000",
        "bug_report": {
            "Title": "NPE in LastImageSubscriptionRecoveryPolicy",
            "Description": "Start up a subscriber when no messages are available and this NPE will eventually get logged:\n\n2011-12-02 15:01:00,588 | WARN  | Failed to browse Topic: xxx | org.apache.activemq.broker.region.Topic | ActiveMQ Broker[xxx] Scheduler\njava.lang.NullPointerException\n\tat org.apache.activemq.broker.region.policy.LastImageSubscriptionRecoveryPolicy.browse(LastImageSubscriptionRecoveryPolicy.java:63)\n\tat org.apache.activemq.broker.region.Topic.browse(Topic.java:564)\n\tat org.apache.activemq.broker.region.Topic$6.run(Topic.java:659)\n\tat org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)\n\tat java.util.TimerThread.mainLoop(Timer.java:512)\n\tat java.util.TimerThread.run(Timer.java:462)\n\nrepeatedly every 30 seconds or so until a message is sent to the topic.",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-6016.json",
        "creation_time": "2015-10-21T12:55:55.000+0000",
        "bug_report": {
            "Title": "java.lang.IllegalArgumentException: Comparison method violates its general contract!",
            "Description": "The message group balancing is based on state in the consumer that can be shared across destinations in error. Under load this can lead to:{code}\n2015-04-13 10:24:20,034 | WARN  | IO Worker 308792 | Service                          | ivemq.broker.TransportConnection  312 | 121 - org.apache.activemq.activemq-osgi - 5.9.0 | Async error occurred: \njava.lang.IllegalArgumentException: Comparison method violates its general contract!\n\tat java.util.TimSort.mergeHi(TimSort.java:868)[:1.7.0_65]\n\tat java.util.TimSort.mergeAt(TimSort.java:485)[:1.7.0_65]\n\tat java.util.TimSort.mergeCollapse(TimSort.java:410)[:1.7.0_65]\n\tat java.util.TimSort.sort(TimSort.java:214)[:1.7.0_65]\n\tat java.util.TimSort.sort(TimSort.java:173)[:1.7.0_65]\n\tat java.util.Arrays.sort(Arrays.java:659)[:1.7.0_65]\n\tat java.util.Collections.sort(Collections.java:217)[:1.7.0_65]\n\tat org.apache.activemq.broker.region.Queue.addToConsumerList(Queue.java:2131)[121:org.apache.activemq.activemq-osgi:5.9.0]\n\tat org.apache.activemq.broker.region.Queue.doActualDispatch(Queue.java:2067)[121:org.apache.activemq.activemq-osgi:5.9.0]\n\tat org.apache.activemq.broker.region.Queue.doDispatch(Queue.java:1972)[121:org.apache.activemq.activemq-osgi:5.9.0]\n\tat org.apache.activemq.broker.region.Queue.removeSubscription(Queue.java:587)[121:org.apache.activemq.activemq-osgi:5.9.0]\n\tat org.apache.activemq.broker.region.DestinationFilter.removeSubscription(DestinationFilter.java:127)[121:org.apache.activemq.activemq-osgi:5.9.0]\n\tat ......\n\tat java.lang.Thread.run(Thread.java:745)[:1.7.0_65]{code}",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-3490.json",
        "creation_time": "2011-09-08T20:31:57.000+0000",
        "bug_report": {
            "Title": "NPEs during message processing, using FileCursor",
            "Description": "In a scenario where a single-consumer queue for non-presistent messages uses a file cursor to manage a backlog, bursts of messages result in NPEs.\n\nThread dumps for 3 different examples:\n\n2011-09-07 12:43:27,057 ERROR [cursors.FilePendingMessageCursor] [] : [Usage Async Task] Caught an IO Exception getting the DiskList7_PendingCursor:snTableQueue_CHF\njava.lang.NullPointerExceptionnull\n    at java.io.Writer.write(Writer.java:140)null\n    at java.io.BufferedWriter.newLine(BufferedWriter.java:225)null\n    at java.util.Properties.writeComments(Properties.java:671)null\n    at java.util.Properties.store0(Properties.java:805)null\n    at java.util.Properties.store(Properties.java:796)null\n    at org.apache.kahadb.page.PageFile.storeMetaData(PageFile.java:570)null\n    at org.apache.kahadb.page.PageFile.load(PageFile.java:361)null\n    at org.apache.activemq.store.kahadb.plist.PListStore.intialize(PListStore.java:285)null\n    at org.apache.activemq.store.kahadb.plist.PListStore.getPList(PListStore.java:218)null\n    at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.getDiskList(FilePendingMessageCursor.java:457)null\n    at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.flushToDisk(FilePendingMessageCursor.java:435)null\n    at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.onUsageChanged(FilePendingMessageCursor.java:388)null\n    at org.apache.activemq.usage.Usage$1.run(Usage.java:268)null\n    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)null\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)null\n    at java.lang.Thread.run(Thread.java: 619)null\nException in thread \"Usage Async Task\" java.lang.RuntimeException: java.lang.NullPointerException\n\n    at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.getDiskList(FilePendingMessageCursor.java:460)\n\n    at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.flushToDisk(FilePendingMessageCursor.java:435)\n\n    at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.onUsageChanged(FilePendingMessageCursor.java:388)\n\n    at org.apache.activemq.usage.Usage$1.run(Usage.java:268)\n\n    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\n    at java.lang.Thread.run(Thread.java:619)\nCaused by: java.lang.NullPointerException\n\n    at java.io.Writer.write(Writer.java:140)\n\n    at java.io.BufferedWriter.newLine(BufferedWriter.java:225)\n\n    at java.util.Properties.writeComments(Properties.java:671)\n\n\n================================================================\n\n2011-09-07 12:43:40,908 ERROR [cursors.FilePendingMessageCursor] [1315421994681] : [ActiveMQ Transport: tcp:///134.242.171.26:35469]\n Caught an IO Exception getting the DiskList 7_PendingCursor:snTableQueue_CHF\njava.lang.NullPointerExceptionnull\n    at org.apache.activemq.store.kahadb.plist.PListStore$1.execute(PListStore.java:229)null\n    at org.apache.kahadb.page.Transaction.execute(Transaction.java:760)null\n    at org.apache.activemq.store.kahadb.plist.PListStore.getPLis\nt(PListStore.java:225)null\n    at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.getDiskList(FilePendingMessageCursor.java:457)null\n    at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.tryAddMessageLast(FilePendingMessageCursor.java:226)null\n    at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.addMessageLast(FilePendingMessageCursor.java:196)null\n    at org.apache.activemq.broker.region.Queue.sendMessage(Queue.java:1603)null  \n    at org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:715)null\n    at org.apache.activemq.broker.region.Queue.send(Queue.java:647)null\n    at org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:409)null\n    at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:543)null\n    at org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:301)null\n    at o\nrg.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)null\n    at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)null\n    at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:306)null\n\n    at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)null  \n    at org.apache.activemq.security.AuthorizationBroker.send(AuthorizationBroker.java:192)null\n    at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)null  \n    at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:135)null\n    at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:468)null\n    at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:68\n1)null\n    at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:316)null\n    at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:180)null\n    at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)null\n    at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)null\n\n    at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:216)null\n    at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)null\n    at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:222)null\n    at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:204)null      \n    at java.lang.Thread.run(Thread.java:619)null\n\n=======================================================================================\n\n\n2011-09-07 12:43:41,028 ERROR [cursors.FilePendingMessageCursor] [1315421994681] : [ActiveMQ Transport: tcp:///134.242.171.26:35469]\n Caught an Exception adding a message: ActiveMQObjectMessage {commandId = 82, responseRequired = false, messageId = ID:lgvn-330\n53-1315415867932-0:19:1:1:78, originalDestination = null, originalTransactionId = null, producerId = ID:lgvn-33053-131541586793\n2-0:19:1:1, destination = queue://snTableQueue_CHF, transactionId = null, expiration = 0, timestamp = 1315424620840,\n arrival = 0, brokerInTime = 1315424620881, brokerOutTime = 0, correlationId = null, replyTo = null, persistent = false, type = null\n, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activemq.util.ByteSequence@d42d49, marshalledProperties = org.apache.activemq.util.ByteSequence@1e91c40, dataStructure = null, redeliveryCounter = 0, size = 0, properties = {TO=0, FROM=37, HOST=134.242.171.26, trigger_name=com.foo.receiver.beans.ACTData, version=3.4}, readOnlyProperties = false, readOnlyBody = false, droppable = false} first to FilePendingMessageCursor\njava.lang.RuntimeException: java.lang.NullPointerExceptionnull\n    at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.getDiskList(FilePendingMessageCursor.java:460)null\n    at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.tryAddMessageLast(FilePendingMessageCursor.java:226)null\n    at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.addMessageLast(FilePendingMessageCursor.java:196)null\n    at org.apache.activemq.broker.region.Queue.sendMessage(Queue.java:1603)null  \n    at org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:715)null\n    at org.apache.activemq.broker.region.Queue.send(Queue.java:647)null\n    at org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:409)null\n    at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:543)null\n    at org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBrok\ner.java:301)null\n    at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)null  \n    at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)null\n    at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:306)null\n    at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)null    \n    at org.apache.activemq.security.AuthorizationBroker.send(AuthorizationBroker.java:192)null\n    at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)null\n    at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:135)null      \n    at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:468)null\n    at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:681)null\n    at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:316)null\n\n    at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:180)null\n    at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)null  \n    at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)null\n    at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:216)null      \n    at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)null    \n    at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:222)null\n    at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:204)null  \n    at java.lang.Thread.run(Thread.java:619)nullCaused by: java.lang.NullPointerExceptionnull    \n    at org.apache.activemq.store.kahadb.plist.PListStore$1.execute(PListStore.java:229)null  \n    at org.apache.kahadb.page.Transaction.execute(Transaction.java:760)null  \n    at org.apache.activemq.store.kahadb.plist.PListStore.getPList(PListStore.java:225)null\n    at org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.getDiskList(FilePendingMessageCursor.java:457)null  \n\n        ... 26 morenull ",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-6831.json",
        "creation_time": "2017-10-09T10:35:53.000+0000",
        "bug_report": {
            "Title": "Broker fails to start complaining about missing/corrupt journal files after upgrading to 5.15.1",
            "Description": "{code}\r\n2017-10-09 12:29:36.802 ERROR 4197 --- [pool-3-thread-1] org.deku.leoz.node.Application           : java.io.IOException: Detected missing/corrupt journal files referenced by:[0:ActiveMQ.DLQ] 3 messages affected.\r\n\r\njava.lang.Error: java.io.IOException: Detected missing/corrupt journal files referenced by:[0:ActiveMQ.DLQ] 3 messages affected.\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1148) ~[na:1.8.0_131]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[na:1.8.0_131]\r\n\tat java.lang.Thread.run(Thread.java:748) ~[na:1.8.0_131]\r\nCaused by: java.io.IOException: Detected missing/corrupt journal files referenced by:[0:ActiveMQ.DLQ] 3 messages affected.\r\n\tat org.apache.activemq.store.kahadb.MessageDatabase.recoverIndex(MessageDatabase.java:965) ~[activemq-kahadb-store-5.15.1.jar:5.15.1]\r\n\tat org.apache.activemq.store.kahadb.MessageDatabase$5.execute(MessageDatabase.java:717) ~[activemq-kahadb-store-5.15.1.jar:5.15.1]\r\n\tat org.apache.activemq.store.kahadb.disk.page.Transaction.execute(Transaction.java:779) ~[activemq-kahadb-store-5.15.1.jar:5.15.1]\r\n\tat org.apache.activemq.store.kahadb.MessageDatabase.recover(MessageDatabase.java:714) ~[activemq-kahadb-store-5.15.1.jar:5.15.1]\r\n\tat org.apache.activemq.store.kahadb.MessageDatabase.open(MessageDatabase.java:473) ~[activemq-kahadb-store-5.15.1.jar:5.15.1]\r\n\tat org.apache.activemq.store.kahadb.MessageDatabase.load(MessageDatabase.java:493) ~[activemq-kahadb-store-5.15.1.jar:5.15.1]\r\n\tat org.apache.activemq.store.kahadb.MessageDatabase.doStart(MessageDatabase.java:297) ~[activemq-kahadb-store-5.15.1.jar:5.15.1]\r\n\tat org.apache.activemq.store.kahadb.KahaDBStore.doStart(KahaDBStore.java:219) ~[activemq-kahadb-store-5.15.1.jar:5.15.1]\r\n\tat org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:55) ~[activemq-client-5.15.1.jar:5.15.1]\r\n\tat org.apache.activemq.store.kahadb.KahaDBPersistenceAdapter.doStart(KahaDBPersistenceAdapter.java:232) ~[activemq-kahadb-store-5.15.1.jar:5.15.1]\r\n{code}\r\n\r\nDowngrading to 5.15.0 resolves the problem.\r\nThis is an embedded broker setup, using\r\n\r\n{code:none}\r\n        val pa = brokerService.persistenceAdapter as KahaDBPersistenceAdapter\r\n        pa.isCheckForCorruptJournalFiles = true\r\n        pa.isIgnoreMissingJournalfiles = false\r\n{code}",
            "Priority": "Critical"
        }
    },
    {
        "filename": "AMQ-5525.json",
        "creation_time": "2015-01-19T13:47:50.000+0000",
        "bug_report": {
            "Title": "error converting collection entry - activemq:browse karaf command  via itests",
            "Description": "failures:\n{code}  ActiveMQAMQPBrokerFeatureTest>ActiveMQBrokerFeatureTest.test:70->AbstractFeatureTest.withinReason:259 expected:<[JMS_BODY_FIELD:JMSText = 1421674632296]> but was:<[]>\n  ActiveMQBrokerFeatureTest.test:70->AbstractFeatureTest.withinReason:259 expected:<[JMS_BODY_FIELD:JMSText = 1421674680492]> but was:<[]>{code} root cause - somewhere in blueprint converter. \n{code}java.lang.Exception: Unable to convert from [--amqurl, tcp://localhost:61616, --user, karaf, --password, karaf, -Vbody, 1421674680492] to java.util.ArrayList<java.lang.String>(error converting collection entry)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convertToCollection(AggregateConverter.java:342)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convert(AggregateConverter.java:182)\n\tat org.apache.activemq.karaf.commands.ActiveMQCommand$ActiveMQActionPreparator.convert(ActiveMQCommand.java:143)\n\tat org.apache.activemq.karaf.commands.ActiveMQCommand$ActiveMQActionPreparator.prepare(ActiveMQCommand.java:134)\n\tat org.apache.felix.gogo.commands.basic.AbstractCommand.execute(AbstractCommand.java:34)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.apache.aries.proxy.impl.ProxyHandler$1.invoke(ProxyHandler.java:54)\n\tat org.apache.aries.proxy.impl.ProxyHandler.invoke(ProxyHandler.java:119)\n\tat org.apache.activemq.karaf.commands.$ActiveMQCommand695030723.execute(Unknown Source)\n\tat org.apache.felix.gogo.runtime.CommandProxy.execute(CommandProxy.java:78)\n\tat org.apache.felix.gogo.runtime.Closure.executeCmd(Closure.java:477)\n\tat org.apache.felix.gogo.runtime.Closure.executeStatement(Closure.java:403)\n\tat org.apache.felix.gogo.runtime.Pipe.run(Pipe.java:108)\n\tat org.apache.felix.gogo.runtime.Closure.execute(Closure.java:183)\n\tat org.apache.felix.gogo.runtime.Closure.execute(Closure.java:120)\n\tat org.apache.felix.gogo.runtime.CommandSessionImpl.execute(CommandSessionImpl.java:92)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1$1.run(AbstractFeatureTest.java:125)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1$1.run(AbstractFeatureTest.java:117)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:356)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1.call(AbstractFeatureTest.java:117)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1.call(AbstractFeatureTest.java:109)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.Exception: Unable to convert value 1421674680492 to type java.lang.String\n\tat org.apache.aries.blueprint.container.AggregateConverter.convert(AggregateConverter.java:184)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convertToCollection(AggregateConverter.java:340)\n\t... 30 more\n2015-01-19 13:38:05,367 | ERROR | Thread-30        | AbstractFeatureTest              | 125 - PAXEXAM-PROBE-a407b767-4b95-4f93-8124-64d04dc65582 - 0.0.0 | Execute: activemq:browse --amqurl tcp://localhost:61616 --user karaf --password karaf -Vbody 1421674680492 - Response:\nactivemq:browse --amqurl tcp://localhost:61616 --user karaf --password karaf -Vbody 1421674680492\njava.lang.Exception: Unable to convert from [--amqurl, tcp://localhost:61616, --user, karaf, --password, karaf, -Vbody, 1421674680492] to java.util.ArrayList<java.lang.String>(error converting collection entry)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convertToCollection(AggregateConverter.java:342)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convert(AggregateConverter.java:182)\n\tat org.apache.activemq.karaf.commands.ActiveMQCommand$ActiveMQActionPreparator.convert(ActiveMQCommand.java:143)\n\tat org.apache.activemq.karaf.commands.ActiveMQCommand$ActiveMQActionPreparator.prepare(ActiveMQCommand.java:134)\n\tat org.apache.felix.gogo.commands.basic.AbstractCommand.execute(AbstractCommand.java:34)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.apache.aries.proxy.impl.ProxyHandler$1.invoke(ProxyHandler.java:54)\n\tat org.apache.aries.proxy.impl.ProxyHandler.invoke(ProxyHandler.java:119)\n\tat org.apache.activemq.karaf.commands.$ActiveMQCommand695030723.execute(Unknown Source)\n\tat org.apache.felix.gogo.runtime.CommandProxy.execute(CommandProxy.java:78)\n\tat org.apache.felix.gogo.runtime.Closure.executeCmd(Closure.java:477)\n\tat org.apache.felix.gogo.runtime.Closure.executeStatement(Closure.java:403)\n\tat org.apache.felix.gogo.runtime.Pipe.run(Pipe.java:108)\n\tat org.apache.felix.gogo.runtime.Closure.execute(Closure.java:183)\n\tat org.apache.felix.gogo.runtime.Closure.execute(Closure.java:120)\n\tat org.apache.felix.gogo.runtime.CommandSessionImpl.execute(CommandSessionImpl.java:92)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1$1.run(AbstractFeatureTest.java:125)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1$1.run(AbstractFeatureTest.java:117)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:356)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1.call(AbstractFeatureTest.java:117)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1.call(AbstractFeatureTest.java:109)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.Exception: Unable to convert value 1421674680492 to type java.lang.String\n\tat org.apache.aries.blueprint.container.AggregateConverter.convert(AggregateConverter.java:184)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convertToCollection(AggregateConverter.java:340)\n\t... 30 more\n2015-01-19 13:38:06,379 | ERROR | Thread-30        | AbstractFeatureTest              | 125 - PAXEXAM-PROBE-a407b767-4b95-4f93-8124-64d04dc65582 - 0.0.0 | Execute: activemq:browse --amqurl tcp://localhost:61616 --user karaf --password karaf -Vbody 1421674680492 - Response:\nactivemq:browse --amqurl tcp://localhost:61616 --user karaf --password karaf -Vbody 1421674680492\njava.lang.Exception: Unable to convert from [--amqurl, tcp://localhost:61616, --user, karaf, --password, karaf, -Vbody, 1421674680492] to java.util.ArrayList<java.lang.String>(error converting collection entry)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convertToCollection(AggregateConverter.java:342)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convert(AggregateConverter.java:182)\n\tat org.apache.activemq.karaf.commands.ActiveMQCommand$ActiveMQActionPreparator.convert(ActiveMQCommand.java:143)\n\tat org.apache.activemq.karaf.commands.ActiveMQCommand$ActiveMQActionPreparator.prepare(ActiveMQCommand.java:134)\n\tat org.apache.felix.gogo.commands.basic.AbstractCommand.execute(AbstractCommand.java:34)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.apache.aries.proxy.impl.ProxyHandler$1.invoke(ProxyHandler.java:54)\n\tat org.apache.aries.proxy.impl.ProxyHandler.invoke(ProxyHandler.java:119)\n\tat org.apache.activemq.karaf.commands.$ActiveMQCommand695030723.execute(Unknown Source)\n\tat org.apache.felix.gogo.runtime.CommandProxy.execute(CommandProxy.java:78)\n\tat org.apache.felix.gogo.runtime.Closure.executeCmd(Closure.java:477)\n\tat org.apache.felix.gogo.runtime.Closure.executeStatement(Closure.java:403)\n\tat org.apache.felix.gogo.runtime.Pipe.run(Pipe.java:108)\n\tat org.apache.felix.gogo.runtime.Closure.execute(Closure.java:183)\n\tat org.apache.felix.gogo.runtime.Closure.execute(Closure.java:120)\n\tat org.apache.felix.gogo.runtime.CommandSessionImpl.execute(CommandSessionImpl.java:92)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1$1.run(AbstractFeatureTest.java:125)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1$1.run(AbstractFeatureTest.java:117)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:356)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1.call(AbstractFeatureTest.java:117)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1.call(AbstractFeatureTest.java:109)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.Exception: Unable to convert value 1421674680492 to type java.lang.String\n\tat org.apache.aries.blueprint.container.AggregateConverter.convert(AggregateConverter.java:184)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convertToCollection(AggregateConverter.java:340)\n\t... 30 more\n2015-01-19 13:38:07,390 | ERROR | Thread-30        | AbstractFeatureTest              | 125 - PAXEXAM-PROBE-a407b767-4b95-4f93-8124-64d04dc65582 - 0.0.0 | Execute: activemq:browse --amqurl tcp://localhost:61616 --user karaf --password karaf -Vbody 1421674680492 - Response:\nactivemq:browse --amqurl tcp://localhost:61616 --user karaf --password karaf -Vbody 1421674680492\njava.lang.Exception: Unable to convert from [--amqurl, tcp://localhost:61616, --user, karaf, --password, karaf, -Vbody, 1421674680492] to java.util.ArrayList<java.lang.String>(error converting collection entry)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convertToCollection(AggregateConverter.java:342)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convert(AggregateConverter.java:182)\n\tat org.apache.activemq.karaf.commands.ActiveMQCommand$ActiveMQActionPreparator.convert(ActiveMQCommand.java:143)\n\tat org.apache.activemq.karaf.commands.ActiveMQCommand$ActiveMQActionPreparator.prepare(ActiveMQCommand.java:134)\n\tat org.apache.felix.gogo.commands.basic.AbstractCommand.execute(AbstractCommand.java:34)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.apache.aries.proxy.impl.ProxyHandler$1.invoke(ProxyHandler.java:54)\n\tat org.apache.aries.proxy.impl.ProxyHandler.invoke(ProxyHandler.java:119)\n\tat org.apache.activemq.karaf.commands.$ActiveMQCommand695030723.execute(Unknown Source)\n\tat org.apache.felix.gogo.runtime.CommandProxy.execute(CommandProxy.java:78)\n\tat org.apache.felix.gogo.runtime.Closure.executeCmd(Closure.java:477)\n\tat org.apache.felix.gogo.runtime.Closure.executeStatement(Closure.java:403)\n\tat org.apache.felix.gogo.runtime.Pipe.run(Pipe.java:108)\n\tat org.apache.felix.gogo.runtime.Closure.execute(Closure.java:183)\n\tat org.apache.felix.gogo.runtime.Closure.execute(Closure.java:120)\n\tat org.apache.felix.gogo.runtime.CommandSessionImpl.execute(CommandSessionImpl.java:92)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1$1.run(AbstractFeatureTest.java:125)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1$1.run(AbstractFeatureTest.java:117)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:356)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1.call(AbstractFeatureTest.java:117)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1.call(AbstractFeatureTest.java:109)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.Exception: Unable to convert value 1421674680492 to type java.lang.String\n\tat org.apache.aries.blueprint.container.AggregateConverter.convert(AggregateConverter.java:184)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convertToCollection(AggregateConverter.java:340)\n\t... 30 more\n2015-01-19 13:38:08,400 | ERROR | Thread-30        | AbstractFeatureTest              | 125 - PAXEXAM-PROBE-a407b767-4b95-4f93-8124-64d04dc65582 - 0.0.0 | Execute: activemq:browse --amqurl tcp://localhost:61616 --user karaf --password karaf -Vbody 1421674680492 - Response:\nactivemq:browse --amqurl tcp://localhost:61616 --user karaf --password karaf -Vbody 1421674680492\njava.lang.Exception: Unable to convert from [--amqurl, tcp://localhost:61616, --user, karaf, --password, karaf, -Vbody, 1421674680492] to java.util.ArrayList<java.lang.String>(error converting collection entry)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convertToCollection(AggregateConverter.java:342)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convert(AggregateConverter.java:182)\n\tat org.apache.activemq.karaf.commands.ActiveMQCommand$ActiveMQActionPreparator.convert(ActiveMQCommand.java:143)\n\tat org.apache.activemq.karaf.commands.ActiveMQCommand$ActiveMQActionPreparator.prepare(ActiveMQCommand.java:134)\n\tat org.apache.felix.gogo.commands.basic.AbstractCommand.execute(AbstractCommand.java:34)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.apache.aries.proxy.impl.ProxyHandler$1.invoke(ProxyHandler.java:54)\n\tat org.apache.aries.proxy.impl.ProxyHandler.invoke(ProxyHandler.java:119)\n\tat org.apache.activemq.karaf.commands.$ActiveMQCommand695030723.execute(Unknown Source)\n\tat org.apache.felix.gogo.runtime.CommandProxy.execute(CommandProxy.java:78)\n\tat org.apache.felix.gogo.runtime.Closure.executeCmd(Closure.java:477)\n\tat org.apache.felix.gogo.runtime.Closure.executeStatement(Closure.java:403)\n\tat org.apache.felix.gogo.runtime.Pipe.run(Pipe.java:108)\n\tat org.apache.felix.gogo.runtime.Closure.execute(Closure.java:183)\n\tat org.apache.felix.gogo.runtime.Closure.execute(Closure.java:120)\n\tat org.apache.felix.gogo.runtime.CommandSessionImpl.execute(CommandSessionImpl.java:92)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1$1.run(AbstractFeatureTest.java:125)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1$1.run(AbstractFeatureTest.java:117)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:356)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1.call(AbstractFeatureTest.java:117)\n\tat org.apache.activemq.karaf.itest.AbstractFeatureTest$1.call(AbstractFeatureTest.java:109)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.Exception: Unable to convert value 1421674680492 to type java.lang.String\n\tat org.apache.aries.blueprint.container.AggregateConverter.convert(AggregateConverter.java:184)\n\tat org.apache.aries.blueprint.container.AggregateConverter.convertToCollection(AggregateConverter.java:340){code}",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-4118.json",
        "creation_time": "2012-10-19T22:14:13.000+0000",
        "bug_report": {
            "Title": "Index page overflow (when a value does not fit in a page) can lead to duplicate calls to free",
            "Description": "An overflowed chain is release when it is no longer needed, but the new end page was not stored in the cache, the old value as a part page is reused and freed again. boom. Keeping the cache in sync sorts this.\nA workaround is to disable the index page cache with a small indexCacheSize.\nDurable subs make this more visible, but the failure symptoms vary with usage. A typical scenario is a classcast when the page is reused in the wrong context or a npe when the free page is loaded from disk.\nWith durable subs with selectors and large backlogs, the sequence set expansion and shrinkage produces values that can overflow easily. This scenario produced a nice test.\n\nSome resultant stack traces that are symptomatic:\n{code}2012-10-19 22:25:11,928 [exPageUsage#5-2] - ERROR MessageDatabase                - KahaDB failed to store to Journal\njava.io.EOFException: Chunk stream does not exist, page: 1344 is marked free\n\tat org.apache.kahadb.page.Transaction$2.readPage(Transaction.java:481)\n\tat org.apache.kahadb.page.Transaction$2.<init>(Transaction.java:458)\n\tat org.apache.kahadb.page.Transaction.openInputStream(Transaction.java:455)\n\tat org.apache.kahadb.page.Transaction.load(Transaction.java:431)\n\tat org.apache.kahadb.page.Transaction.load(Transaction.java:388)\n\tat org.apache.kahadb.index.BTreeIndex.loadNode(BTreeIndex.java:262)\n\tat org.apache.kahadb.index.BTreeNode.getChild(BTreeNode.java:225)\n\tat org.apache.kahadb.index.BTreeNode.getLeafNode(BTreeNode.java:680)\n\tat org.apache.kahadb.index.BTreeNode.get(BTreeNode.java:562)\n\tat org.apache.kahadb.index.BTreeIndex.get(BTreeIndex.java:184)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$MessageOrderIndex.get(MessageDatabase.java:2616)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.updateIndex(MessageDatabase.java:1210)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$15.execute(MessageDatabase.java:1002)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:790)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.process(MessageDatabase.java:1000)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$13.visit(MessageDatabase.java:933)\n\tat org.apache.activemq.store.kahadb.data.KahaRemoveMessageCommand.visit(KahaRemoveMessageCommand.java:220)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.process(MessageDatabase.java:925)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:837)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:819)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBTopicMessageStore.doAcknowledge(KahaDBStore.java:723)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBTopicMessageStore.acknowledge(KahaDBStore.java:706)\n\tat org.apache.activemq.store.kahadb.KahaDBTransactionStore.acknowledge(KahaDBTransactionStore.java:519)\n\tat org.apache.activemq.store.kahadb.KahaDBTransactionStore$2.acknowledge(KahaDBTransactionStore.java:222)\n\tat org.apache.activemq.broker.region.Topic.acknowledge(Topic.java:528)\n\tat org.apache.activemq.broker.region.DurableTopicSubscription.acknowledge(DurableTopicSubscription.java:279)\n\tat ..{code}\n{code}java.lang.ClassCastException: java.lang.Long cannot be cast to java.lang.String\n        at java.lang.String.compareTo(String.java:92)\n        at java.util.Arrays.binarySearch0(Arrays.java:2001)\n        at java.util.Arrays.binarySearch(Arrays.java:1943)\n        at org.apache.kahadb.index.BTreeNode.put(BTreeNode.java:371)\n        at org.apache.kahadb.index.BTreeNode.put(BTreeNode.java:369)       \n        at org.apache.kahadb.index.BTreeIndex.put(BTreeIndex.java:189)        \nat org.apache.activemq.store.kahadb.MessageDatabase$MessageOrderIndex.put(MessageDatabase.java:2592)\n        at org.apache.activemq.store.kahadb.MessageDatabase.upadateIndex(MessageDatabase.java:1168)        at org.apache.activemq.store.kahadb.MessageDatabase$AddOpperation.execute(MessageDatabase.java:2082)        at org.apache.activemq.store.kahadb.MessageDatabase$18.execute(MessageDatabase.java:1095)        at org.apache.kahadb.page.Transaction.execute(Transaction.java:768)\n        at org.apache.activemq.store.kahadb.MessageDatabase.process(MessageDatabase.java:1092)\n        at org.apache.activemq.store.kahadb.MessageDatabase$13.visit(MessageDatabase.java:961)\n        at org.apache.activemq.store.kahadb.data.KahaCommitCommand.visit(KahaCommitCommand.java:130)\n        at org.apache.activemq.store.kahadb.MessageDatabase.process(MessageDatabase.java:943)\n        at org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:855)\n        at org.apache.activemq.store.kahadb.KahaDBTransactionStore.commit(KahaDBTransactionStore.java:267)\n        at org.apache.activemq.transaction.XATransaction.storeCommit(XATransaction.java:85)\n...{code}\n{code}java.lang.NullPointerException\n        at org.apache.kahadb.index.BTreeIndex.loadNode(BTreeIndex.java:264)\n        at org.apache.kahadb.index.BTreeNode.getChild(BTreeNode.java:225)\n        at org.apache.kahadb.index.BTreeNode.getLeafNode(BTreeNode.java:676)\n        at org.apache.kahadb.index.BTreeNode.put(BTreeNode.java:369)\n        at org.apache.kahadb.index.BTreeIndex.put(BTreeIndex.java:189)\n        at org.apache.activemq.store.kahadb.MessageDatabase$MessageOrderIndex.put(MessageDatabase.java:2592)\n        at org.apache.activemq.store.kahadb.MessageDatabase.upadateIndex(MessageDatabase.java:1168)\n        at org.apache.activemq.store.kahadb.MessageDatabase$AddOpperation.execute(MessageDatabase.java:2082)\n        at org.apache.activemq.store.kahadb.MessageDatabase$18.execute(MessageDatabase.java:1095)\n        at org.apache.kahadb.page.Transaction.execute(Transaction.java:768)\n        at org.apache.activemq.store.kahadb.MessageDatabase.process(MessageDatabase.java:1092)\n        at org.apache.activemq.store.kahadb.MessageDatabase$13.visit(MessageDatabase.java:961)\n        at org.apache.activemq.store.kahadb.data.KahaCommitCommand.visit(KahaCommitCommand.java:130)\n        at org.apache.activemq.store.kahadb.MessageDatabase.process(MessageDatabase.java:943)\n        at org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:855)\n        at org.apache.activemq.store.kahadb.KahaDBTransactionStore.commit(KahaDBTransactionStore.java:267){code}",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-4092.json",
        "creation_time": "2012-10-04T02:56:44.000+0000",
        "bug_report": {
            "Title": "ConcurrentModificationException when using message groups",
            "Description": "seeing these WARN messages frequently while consuming (maxConcurrentConsumers=5) from a queue with the message groups header (JMSXGroupID) set.  If I disable the message groups header, these errors go away...  \n\nThat said, I don't see any specific errors with my application (at this point), just these messages in my logs.\n\n2012-10-04 02:34:02,552 |  WARN - Service              - | Async error occurred: java.util.concurrent.ExecutionException: java.util.ConcurrentModificationException\njava.util.concurrent.ExecutionException: java.util.ConcurrentModificationException\n\tat java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)\n\tat java.util.concurrent.FutureTask.get(FutureTask.java:83)\n\tat org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:785)\n\tat org.apache.activemq.broker.region.Queue.send(Queue.java:707)\n\tat org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:407)\n\tat org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:503)\n\tat org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:305)\n\tat org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)\n\tat org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n\tat org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:306)\n\tat org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:135)\n\tat org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:453)\n\tat org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:681)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:292)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:150)\n\tat org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)\n\tat org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n\tat org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:231)\n\tat org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:122)\n\tat org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:43)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:680)\nCaused by: java.util.ConcurrentModificationException\n\tat java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)\n\tat java.util.HashMap$KeyIterator.next(HashMap.java:828)\n\tat org.apache.activemq.util.MarshallingSupport.marshalPrimitiveMap(MarshallingSupport.java:64)\n\tat org.apache.activemq.command.Message.beforeMarshall(Message.java:210)\n\tat org.apache.activemq.command.ActiveMQObjectMessage.beforeMarshall(ActiveMQObjectMessage.java:199)\n\tat org.apache.activemq.openwire.v6.MessageMarshaller.looseMarshal(MessageMarshaller.java:277)\n\tat org.apache.activemq.openwire.v6.ActiveMQMessageMarshaller.looseMarshal(ActiveMQMessageMarshaller.java:111)\n\tat org.apache.activemq.openwire.v6.ActiveMQObjectMessageMarshaller.looseMarshal(ActiveMQObjectMessageMarshaller.java:111)\n\tat org.apache.activemq.openwire.OpenWireFormat.marshal(OpenWireFormat.java:168)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.addMessage(KahaDBStore.java:429)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$StoreQueueTask.run(KahaDBStore.java:1177)\n\t... 3 more\n",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-3887.json",
        "creation_time": "2012-06-18T16:02:55.000+0000",
        "bug_report": {
            "Title": "Occasional Null Pointer Exception during NetworkConnector connection",
            "Description": "While starting a duplex NetworkConnector an NPE can be observed on the receiving side.\n\n{code}\n2012-06-18 17:34:24,571 INFO  .DemandForwardingBridgeSupport - Network connection between vm://proxy-cbpi001#8 and tcp:///169.254.\n0.5:59412(cbox-56BU101117) has been established. [StartLocalBridge: localBroker=vm://proxy-cbpi001#8]\n2012-06-18 17:34:24,577 WARN  .DemandForwardingBridgeSupport - Caught an exception processing local command [BrokerService[proxy-c\nbpi001] Task-19]\njava.lang.NullPointerException: null\n        at org.apache.activemq.network.DemandForwardingBridgeSupport.configureMessage(DemandForwardingBridgeSupport.java:644) ~[ac\ntivemq-core-5.6.0.jar:5.6.0]\n        at org.apache.activemq.network.DemandForwardingBridgeSupport.serviceLocalCommand(DemandForwardingBridgeSupport.java:675) ~\n[activemq-core-5.6.0.jar:5.6.0]\n        at org.apache.activemq.network.DemandForwardingBridgeSupport$1.onCommand(DemandForwardingBridgeSupport.java:139) [activemq\n-core-5.6.0.jar:5.6.0]\n        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116) [activemq-core-5.6.0.jar:5.6.0]\n        at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50) [activemq-core-5.6.0.jar:5.6.0]\n        at org.apache.activemq.transport.vm.VMTransport.doDispatch(VMTransport.java:135) [activemq-core-5.6.0.jar:5.6.0]\n        at org.apache.activemq.transport.vm.VMTransport.dispatch(VMTransport.java:124) [activemq-core-5.6.0.jar:5.6.0]\n        at org.apache.activemq.transport.vm.VMTransport.oneway(VMTransport.java:103) [activemq-core-5.6.0.jar:5.6.0]\n        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:68) [activemq-core-5.6.0.jar:5.6.0]\n        at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60) [activemq-core-5.6.0.jar:5.6.0]\n        at org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1307) [activemq-core-5.6.0.jar:5.6.0]\n        at org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:837) [activemq-core-5.6.0.jar:5\n.6.0]\n        at org.apache.activemq.broker.TransportConnection.iterate(TransportConnection.java:872) [activemq-core-5.6.0.jar:5.6.0]\n        at org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:122) [activemq-core-5.6.0.jar:5.6.0]\n        at org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:43) [activemq-core-5.6.0.jar:5.6.0]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source) [na:1.6.0_20]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source) [na:1.6.0_20]\n        at java.lang.Thread.run(Unknown Source) [na:1.6.0_20]\n{code}\n\nThe other broker will eventually connect, but with about a hundred of connecting brokers this occurs too often to ignore.\n\nAs this seems to be a race condition it is quite difficult to reproduce reliably. I assume producerInfo is accessed in configureMessage before it is initialized in startRemoteBridge.",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-6451.json",
        "creation_time": "2016-10-03T17:09:00.000+0000",
        "bug_report": {
            "Title": "Preallocation strategy of zeros can leak file descriptors causing crash",
            "Description": "If the preallocationStrategy is set to 'zeros', ActiveMQ can intermittently become unable to allocate direct buffer memory with the default JVM settings. The exception isn't handled, and ends up both creating an empty journal file and, more importantly, leaking a file descriptor.\n\nActiveMQ eventually runs out of file descriptors and crashes.\n\nIn addition to handling this condition, perhaps the default ACTIVEMQ_OPTS_MEMORY settings should configure enough direct memory to allow some multiple of log files to be created near simultaneously, or at least this possibility documented in the KahaDB settings.\n\nRelevant logs:\n\n{noformat}\n2016-10-03 12:47:24,154 | WARN  | Async error occurred: java.lang.OutOfMemoryError: Direct buffer memory | org.apache.activemq.broker.TransportConnection.Service | ActiveMQ Transport: ssl:///x.x.x.x:60805\n2016-10-03 12:47:24,818 | WARN  | Async error occurred: java.lang.OutOfMemoryError: Direct buffer memory | org.apache.activemq.broker.TransportConnection.Service | ActiveMQ Transport: ssl:///x.x.x.x:60811\n2016-10-03 12:47:25,477 | WARN  | Async error occurred: java.lang.OutOfMemoryError: Direct buffer memory | org.apache.activemq.broker.TransportConnection.Service | ActiveMQ Transport: ssl:///x.x.x.x:49830\n2016-10-03 12:47:26,146 | WARN  | Store COMMIT FAILED:  | org.apache.activemq.transaction.LocalTransaction | ActiveMQ Transport: ssl:///x.x.x.x:65534\njava.lang.OutOfMemoryError: Direct buffer memory\n        at java.nio.Bits.reserveMemory(Bits.java:693)[:1.8.0_101]\n        at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)[:1.8.0_101]\n        at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)[:1.8.0_101]\n        at sun.nio.ch.Util.getTemporaryDirectBuffer(Util.java:174)[:1.8.0_101]\n        at sun.nio.ch.IOUtil.write(IOUtil.java:58)[:1.8.0_101]\n        at sun.nio.ch.FileChannelImpl.write(FileChannelImpl.java:211)[:1.8.0_101]\n        at org.apache.activemq.store.kahadb.disk.journal.Journal.doPreallocationZeros(Journal.java:366)[activemq-kahadb-store-5.14.0.jar:5.14.0]\n        at org.apache.activemq.store.kahadb.disk.journal.Journal.preallocateEntireJournalDataFile(Journal.java:333)[activemq-kahadb-store-5.14.0.jar:5.14.0]\n        at org.apache.activemq.store.kahadb.disk.journal.Journal.newDataFile(Journal.java:631)[activemq-kahadb-store-5.14.0.jar:5.14.0]\n        at org.apache.activemq.store.kahadb.disk.journal.Journal.rotateWriteFile(Journal.java:595)[activemq-kahadb-store-5.14.0.jar:5.14.0]\n        at org.apache.activemq.store.kahadb.disk.journal.Journal.getCurrentDataFile(Journal.java:984)[activemq-kahadb-store-5.14.0.jar:5.14.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAppender.enqueue(DataFileAppender.java:189)[activemq-kahadb-store-5.14.0.jar:5.14.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAppender.storeItem(DataFileAppender.java:128)[activemq-kahadb-store-5.14.0.jar:5.14.0]\n        at org.apache.activemq.store.kahadb.disk.journal.Journal.write(Journal.java:890)[activemq-kahadb-store-5.14.0.jar:5.14.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:1108)[activemq-kahadb-store-5.14.0.jar:5.14.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:1090)[activemq-kahadb-store-5.14.0.jar:5.14.0]\n        at org.apache.activemq.store.kahadb.KahaDBTransactionStore.commit(KahaDBTransactionStore.java:301)[activemq-kahadb-store-5.14.0.jar:5.14.0]\n        at org.apache.activemq.transaction.LocalTransaction.commit(LocalTransaction.java:70)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.TransactionBroker.commitTransaction(TransactionBroker.java:252)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.BrokerFilter.commitTransaction(BrokerFilter.java:113)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.BrokerFilter.commitTransaction(BrokerFilter.java:113)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:118)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.TransportConnection.processCommitTransactionOnePhase(TransportConnection.java:535)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:100)[activemq-client-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:333)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:197)[activemq-broker-5.14.0.jar:5.14.0]\n        at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)[activemq-client-5.14.0.jar:5.14.0]\n        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:125)[activemq-client-5.14.0.jar:5.14.0]\n        at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:300)[activemq-client-5.14.0.jar:5.14.0]\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)[activemq-client-5.14.0.jar:5.14.0]\n        at org.apache.activemq.transport.tcp.SslTransport.doConsume(SslTransport.java:108)[activemq-client-5.14.0.jar:5.14.0]\n        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:233)[activemq-client-5.14.0.jar:5.14.0]\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:215)[activemq-client-5.14.0.jar:5.14.0]\n        at java.lang.Thread.run(Thread.java:745)[:1.8.0_101]\n{noformat}\n\nEmpty journal files:\n\n{noformat}\n-rw-r--r-- 1 activemq activemq         0 Oct  3 12:47 db-51425.log\n-rw-r--r-- 1 activemq activemq         0 Oct  3 12:47 db-51426.log\n-rw-r--r-- 1 activemq activemq         0 Oct  3 12:47 db-51427.log\n-rw-r--r-- 1 activemq activemq         0 Oct  3 12:47 db-51428.log\n-rw-r--r-- 1 activemq activemq         0 Oct  3 12:47 db-51429.log\n{noformat}\n\nlsof output:\n\n{noformat}\njava    29263 activemq  452u      REG             202,48         0       160 /activemq/kahadb/db-51425.log\njava    29263 activemq  455u      REG             202,48         0       153 /activemq/kahadb/db-51426.log\njava    29263 activemq  456u      REG             202,48         0       133 /activemq/kahadb/db-51427.log\njava    29263 activemq  462u      REG             202,48         0       157 /activemq/kahadb/db-51428.log\n{noformat}\n",
            "Priority": "Critical"
        }
    },
    {
        "filename": "AMQ-3393.json",
        "creation_time": "2011-07-05T14:31:31.000+0000",
        "bug_report": {
            "Title": "Number of established STOMP connections constantly increasing",
            "Description": "Rapid connect/disconnect can result in dangling stomp transport connection mbeans which eventually accumulate.\nIssue occurs when a disconnect occurs before a broker connection has been fully initiated. The delayed stop, pending start completion was bypassed by a shutdown command from the stomp protocol convertor.\n\nOne potential symptom, when a client side port wrapps around and is reused for the MBean name. There is a registration failure, with {code}2011-06-15 12:27:22,860 [eMQ Task-125034] WARN  ManagedTransportConnection     - Failed to register MBean: org.apache.activemq:BrokerName=xx,Type=Connection,ConnectorName=stomp,ViewType=address,Name=/xx_52170\n2011-06-15 12:27:22,860 [eMQ Task-125034] DEBUG ManagedTransportConnection     - Failure reason: javax.management.InstanceAlreadyExistsException: org.apache.activemq:BrokerName=xx,Type=Connection,ConnectorName=stomp,ViewType=address,Name=/xx_52170\njavax.management.InstanceAlreadyExistsException: org.apache.activemq:BrokerName=xx,Type=Connection,ConnectorName=stomp,ViewType=address,Name=/xx_52170\n\tat com.sun.jmx.mbeanserver.Repository.addMBean(Repository.java:453)\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.internal_addObject(DefaultMBeanServerInterceptor.java:1484)\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerDynamicMBean(DefaultMBeanServerInterceptor.java:963)\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerObject(DefaultMBeanServerInterceptor.java:917)\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:312)\n\tat com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:482)\n\tat org.apache.activemq.broker.jmx.ManagementContext.registerMBean(ManagementContext.java:299)\n\tat org.apache.activemq.broker.jmx.AnnotatedMBean.registerMBean(AnnotatedMBean.java:65)\n\tat org.apache.activemq.broker.jmx.ManagedTransportConnection.registerMBean(ManagedTransportConnection.java:99)\n\tat org.apache.activemq.broker.jmx.ManagedTransportConnection.<init>(ManagedTransportConnection.java:57)\n\tat org.apache.activemq.broker.jmx.ManagedTransportConnector.createConnection(ManagedTransportConnector.java:52)\n\tat org.apache.activemq.broker.TransportConnector$1$1.run(TransportConnector.java:216)\n\tat java.lang.Thread.run(Thread){code}\n",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-5815.json",
        "creation_time": "2015-06-01T12:21:13.000+0000",
        "bug_report": {
            "Title": "Frequency IOException cast dead lock while using kahadb in high concurrency environment",
            "Description": "When the concurrency is in high level, iops more than 3000/s, we find that most of the amq connections are blocked.We can't either get or push any data through them unless restart.This issue appears *frequency*.\n\nThere is many IOExceptions in the amq logs.\n\n{code}\n2015-05-28 00:37:08,544 | ERROR | Checkpoint failed | org.apache.activemq.store.kahadb.MessageDatabase | ActiveMQ Journal Checkpoint Worker\njava.io.IOException: Input/output error\n        at java.io.RandomAccessFile.write(Native Method)[:1.6.0_30]\n        at java.io.RandomAccessFile.writeLong(RandomAccessFile.java:1001)[:1.6.0_30]\n        at org.apache.activemq.util.RecoverableRandomAccessFile.writeLong(RecoverableRandomAccessFile.java:305)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.page.PageFile.writeBatch(PageFile.java:1062)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.page.PageFile.flush(PageFile.java:516)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1512)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase$17.execute(MessageDatabase.java:1484)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.page.Transaction.execute(Transaction.java:779)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1481)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.checkpointCleanup(MessageDatabase.java:929)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase$3.run(MessageDatabase.java:357)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n2015-05-28 00:37:08,547 | INFO  | Ignoring IO exception, java.io.IOException: Input/output error | org.apache.activemq.util.DefaultIOExceptionHandler | ActiveMQ Journal Checkpoint Worker\njava.io.IOException: Input/output error\n        at java.io.RandomAccessFile.write(Native Method)[:1.6.0_30]\n        at java.io.RandomAccessFile.writeLong(RandomAccessFile.java:1001)[:1.6.0_30]\n        at org.apache.activemq.util.RecoverableRandomAccessFile.writeLong(RecoverableRandomAccessFile.java:305)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.page.PageFile.writeBatch(PageFile.java:1062)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.page.PageFile.flush(PageFile.java:516)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1512)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase$17.execute(MessageDatabase.java:1484)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.page.Transaction.execute(Transaction.java:779)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1481)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase.checkpointCleanup(MessageDatabase.java:929)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.MessageDatabase$3.run(MessageDatabase.java:357)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n2015-05-28 00:37:08,580 | INFO  | KahaDB: Recovering checkpoint thread after death | org.apache.activemq.store.kahadb.MessageDatabase | ActiveMQ Transport: tcp:///10.40.50.31:58171@61616\n2015-05-28 00:37:17,285 | INFO  | Journal failed while writing at: 2359276 | org.apache.activemq.store.kahadb.disk.journal.DataFileAppender | ActiveMQ Data File Writer\n2015-05-28 00:37:17,287 | ERROR | KahaDB failed to store to Journal | org.apache.activemq.store.kahadb.MessageDatabase | ActiveMQ Transport: tcp:///10.40.50.17:4487@61616\njava.io.IOException: Input/output error\n        at sun.nio.ch.FileChannelImpl.force0(Native Method)[:1.6.0_30]\n        at sun.nio.ch.FileChannelImpl.force(FileChannelImpl.java:348)[:1.6.0_30]\n        at org.apache.activemq.util.RecoverableRandomAccessFile.sync(RecoverableRandomAccessFile.java:402)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAppender.processQueue(DataFileAppender.java:373)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAppender$1.run(DataFileAppender.java:193)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n2015-05-28 00:37:17,291 | ERROR | KahaDB failed to store to Journal | org.apache.activemq.store.kahadb.MessageDatabase | ActiveMQ Transport: tcp:///10.40.50.17:4442@61616\njava.io.IOException: Input/output error\n        at sun.nio.ch.FileChannelImpl.force0(Native Method)[:1.6.0_30]\n        at sun.nio.ch.FileChannelImpl.force(FileChannelImpl.java:348)[:1.6.0_30]\n        at org.apache.activemq.util.RecoverableRandomAccessFile.sync(RecoverableRandomAccessFile.java:402)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAppender.processQueue(DataFileAppender.java:373)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAppender$1.run(DataFileAppender.java:193)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n2015-05-28 00:37:17,293 | INFO  | Ignoring IO exception, java.io.IOException: Input/output error | org.apache.activemq.util.DefaultIOExceptionHandler | ActiveMQ Transport: tcp:///10.40.50.17:4442@61616\njava.io.IOException: Input/output error\n        at sun.nio.ch.FileChannelImpl.force0(Native Method)[:1.6.0_30]\n        at sun.nio.ch.FileChannelImpl.force(FileChannelImpl.java:348)[:1.6.0_30]\n        at org.apache.activemq.util.RecoverableRandomAccessFile.sync(RecoverableRandomAccessFile.java:402)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAppender.processQueue(DataFileAppender.java:373)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n        at org.apache.activemq.store.kahadb.disk.journal.DataFileAppender$1.run(DataFileAppender.java:193)[activemq-kahadb-store-5.10.0.jar:5.10.0]\n{code}\n\n\nWith the aid of jstack ,we find dead lock(How can I upload the whole jtack log?)\nThe blocked connections are all waiting for 0x00007f90500034e0\n{code}\n[01:08:01] \"ActiveMQ Transport: tcp:///10.40.50.17:4479@61616\" daemon prio=10 tid=0x00007f8f8c015000 nid=0x2ece waiting for monitor entry [0x00007f8f1f6e4000]\n[01:08:01]    java.lang.Thread.State: BLOCKED (on object monitor)\n[01:08:01]         at org.apache.activemq.transaction.LocalTransaction.rollback(LocalTransaction.java:94)\n[01:08:01]         - waiting to lock <0x00007f90500034e0> (a org.apache.activemq.store.kahadb.KahaDBTransactionStore)\n[01:08:01]         at org.apache.activemq.transaction.LocalTransaction.commit(LocalTransaction.java:74)\n[01:08:01]         at org.apache.activemq.broker.TransactionBroker.commitTransaction(TransactionBroker.java:253)\n[01:08:01]         at org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:112)\n[01:08:01]         at org.apache.activemq.broker.TransportConnection.processCommitTransactionOnePhase(TransportConnection.java:453)\n[01:08:01]         at org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:100)\n[01:08:01]         at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:294)\n[01:08:01]         at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:148)\n[01:08:01]         at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n[01:08:01]         at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n[01:08:01]         at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:270)\n[01:08:01]         at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n[01:08:01]         at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n[01:08:01]         at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n[01:08:01]         at java.lang.Thread.run(Thread.java:662)\n{code}\n\nOnly one connection(Thread) get this lock.But it is waiting for another Read lock 0x00007f90530ed8d8\n{code}\n[01:08:01] \"ActiveMQ Transport: tcp:///10.40.50.17:4484@61616\" daemon prio=10 tid=0x00007f8fa8039800 nid=0x2ed2 waiting on condition [0x00007f8f1f2e0000]\n[01:08:01]    java.lang.Thread.State: WAITING (parking)\n[01:08:01]         at sun.misc.Unsafe.park(Native Method)\n[01:08:01]         - parking to wait for  <0x00007f90530ed8d8> (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)\n[01:08:01]         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:156)\n[01:08:01]         at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811)\n[01:08:01]         at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireShared(AbstractQueuedSynchronizer.java:941)\n[01:08:01]         at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireShared(AbstractQueuedSynchronizer.java:1261)\n[01:08:01]         at java.util.concurrent.locks.ReentrantReadWriteLock$ReadLock.lock(ReentrantReadWriteLock.java:594)\n[01:08:01]         at org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:972)\n[01:08:01]         at org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:958)\n[01:08:01]         at org.apache.activemq.store.kahadb.KahaDBTransactionStore.rollback(KahaDBTransactionStore.java:312)\n[01:08:01]         at org.apache.activemq.transaction.LocalTransaction.rollback(LocalTransaction.java:94)\n[01:08:01]         - locked <0x00007f90500034e0> (a org.apache.activemq.store.kahadb.KahaDBTransactionStore)\n[01:08:01]         at org.apache.activemq.transaction.LocalTransaction.commit(LocalTransaction.java:74)\n[01:08:01]         at org.apache.activemq.broker.TransactionBroker.commitTransaction(TransactionBroker.java:253)\n[01:08:01]         at org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:112)\n[01:08:01]         at org.apache.activemq.broker.TransportConnection.processCommitTransactionOnePhase(TransportConnection.java:453)\n[01:08:01]         at org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:100)\n[01:08:01]         at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:294)\n[01:08:01]         at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:148)\n[01:08:01]         at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n[01:08:01]         at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n[01:08:01]         at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:270)\n[01:08:01]         at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n[01:08:01]         at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n[01:08:01]         at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n[01:08:01]         at java.lang.Thread.run(Thread.java:662)\n{code}\n\nAt last we find 0x00007f90530ed8d8 is in many write lock waiting.But none write lock hodes it. The dead lock occurs.\n{code}\n[01:07:56] \"ActiveMQ Transport: tcp:///10.40.50.47:60701@61616\" daemon prio=10 tid=0x00007f8f7cbc5000 nid=0x3ec8 waiting on condition [0x00007f900d864000]\n[01:07:56]    java.lang.Thread.State: WAITING (parking)\n[01:07:56]         at sun.misc.Unsafe.park(Native Method)\n[01:07:56]         - parking to wait for  <0x00007f90530ed8d8> (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)\n[01:07:56]         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:156)\n[01:07:56]         at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811)\n[01:07:56]         at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireShared(AbstractQueuedSynchronizer.java:941)\n[01:07:56]         at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireShared(AbstractQueuedSynchronizer.java:1261)\n[01:07:56]         at java.util.concurrent.locks.ReentrantReadWriteLock$ReadLock.lock(ReentrantReadWriteLock.java:594)\n[01:07:56]         at org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:972)\n[01:07:56]         at org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:958)\n[01:07:56]         at org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.removeMessage(KahaDBStore.java:453)\n[01:07:56]         at org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.removeAsyncMessage(KahaDBStore.java:407)\n[01:07:56]         at org.apache.activemq.store.kahadb.KahaDBTransactionStore.removeAsyncMessage(KahaDBTransactionStore.java:498)\n[01:07:56]         at org.apache.activemq.store.kahadb.KahaDBTransactionStore$1.removeAsyncMessage(KahaDBTransactionStore.java:185)\n[01:07:56]         at org.apache.activemq.broker.region.Queue.acknowledge(Queue.java:998)\n[01:07:56]         at org.apache.activemq.broker.region.Queue.removeMessage(Queue.java:1781)\n[01:07:56]         at org.apache.activemq.broker.region.QueueSubscription.acknowledge(QueueSubscription.java:63)\n[01:07:56]         at org.apache.activemq.broker.region.PrefetchSubscription.acknowledge(PrefetchSubscription.java:235)\n[01:07:56]         - locked <0x00007f905d10b1e8> (a java.lang.Object)\n[01:07:56]         at org.apache.activemq.broker.region.AbstractRegion.acknowledge(AbstractRegion.java:446)\n[01:07:56]         at org.apache.activemq.broker.region.RegionBroker.acknowledge(RegionBroker.java:461)\n[01:07:56]         at org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:82)\n[01:07:56]         at org.apache.activemq.broker.TransactionBroker.acknowledge(TransactionBroker.java:277)\n[01:07:56]         at org.apache.activemq.broker.MutableBrokerFilter.acknowledge(MutableBrokerFilter.java:92)\n[01:07:56]         at org.apache.activemq.broker.TransportConnection.processMessageAck(TransportConnection.java:505)\n[01:07:56]         at org.apache.activemq.command.MessageAck.visit(MessageAck.java:245)\n[01:07:56]         at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:294)\n[01:07:56]         at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:148)\n[01:07:56]         at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n[01:07:56]         at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n[01:07:56]         at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:270)\n[01:07:56]         at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n[01:07:56]         at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n[01:07:56]         at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n[01:07:56]         at java.lang.Thread.run(Thread.java:662)\n{code}\n\nIn my opinion, IOExceptions may lead to losing persisten messages and so on ,but the broker shouldn't stop service.",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-5141.json",
        "creation_time": "2014-04-11T11:31:51.000+0000",
        "bug_report": {
            "Title": "Message expiry that is done as part of a removeSubscription command should not use the clients credentials.",
            "Description": "If the broker handles a RemoveInfo command it may also kick off a message expiry check for (I presume) any prefetched messages. If messages are to be expired they get sent to ActiveMQ.DLQ by default. See stack trace in next comment.\n\nIf the broker is security enabled with authorization turned on and messages get sent to DLQ as a result of the expiry check then the broker uses the client's security context when sending the messages to DLQ. \nThis implies the client user needs to have write access to ActiveMQ.DLQ. \n\nAs this may happen with any other client, all client users will require write access to ActiveMQ.DLQ, which may not be appropriate from a security point of view. \n\nThe broker regularly runs an expiry check and uses a broker internal security context for this task. In my opinion this same broker internal security context should be used when expiring messages as part of the RemoveInfo command. The broker should not use the client's security context. \n\n[1]\nThe current behavior can raise the following SecurityException if the client user does not have write access to ActiveMQ.DLQ\n\n{code}\n2014-04-11 08:11:22,229 | WARN  | 2.38:61201@61616 | RegionBroker | ivemq.broker.region.RegionBroker  703 | \n105 - org.apache.activemq.activemq-osgi - 5.8.0.redhat-60024 | Caught an exception sending to DLQ: Message \nID:S930A3085-50865-635327964441522304-1:1:363:2:1 dropped=false acked=false locked=true\njava.lang.SecurityException: User Test is not authorized to write to: queue://ActiveMQ.DLQ\n\tat org.apache.activemq.security.AuthorizationBroker.send(AuthorizationBroker.java:197)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:135)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.util.BrokerSupport.doResend(BrokerSupport.java:68)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.util.BrokerSupport.resendNoCopy(BrokerSupport.java:38)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.region.RegionBroker.sendToDeadLetterQueue(RegionBroker.java:691)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.sendToDeadLetterQueue(BrokerFilter.java:262)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.sendToDeadLetterQueue(BrokerFilter.java:262)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.advisory.AdvisoryBroker.sendToDeadLetterQueue(AdvisoryBroker.java:413)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.sendToDeadLetterQueue(BrokerFilter.java:262)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.sendToDeadLetterQueue(BrokerFilter.java:262)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.MutableBrokerFilter.sendToDeadLetterQueue(MutableBrokerFilter.java:274)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.util.RedeliveryPlugin.sendToDeadLetterQueue(RedeliveryPlugin.java:132)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.sendToDeadLetterQueue(BrokerFilter.java:262)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.sendToDeadLetterQueue(BrokerFilter.java:262)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.MutableBrokerFilter.sendToDeadLetterQueue(MutableBrokerFilter.java:274)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.region.RegionBroker.messageExpired(RegionBroker.java:659)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.messageExpired(BrokerFilter.java:257)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.messageExpired(BrokerFilter.java:257)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.advisory.AdvisoryBroker.messageExpired(AdvisoryBroker.java:283)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.messageExpired(BrokerFilter.java:257)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.messageExpired(BrokerFilter.java:257)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.MutableBrokerFilter.messageExpired(MutableBrokerFilter.java:269)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.messageExpired(BrokerFilter.java:257)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.messageExpired(BrokerFilter.java:257)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.MutableBrokerFilter.messageExpired(MutableBrokerFilter.java:269)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.region.Queue.messageExpired(Queue.java:1671)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.region.PrefetchSubscription.dispatchPending(PrefetchSubscription.java:648)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.region.PrefetchSubscription.add(PrefetchSubscription.java:162)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.region.Queue.doActualDispatch(Queue.java:1907)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.region.Queue.doDispatch(Queue.java:1834)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.region.Queue.removeSubscription(Queue.java:576)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.region.AbstractRegion.removeConsumer(AbstractRegion.java:380)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.region.RegionBroker.removeConsumer(RegionBroker.java:364)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.jmx.ManagedRegionBroker.removeConsumer(ManagedRegionBroker.java:247)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.removeConsumer(BrokerFilter.java:117)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.removeConsumer(BrokerFilter.java:117)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.advisory.AdvisoryBroker.removeConsumer(AdvisoryBroker.java:253)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.removeConsumer(BrokerFilter.java:117)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.removeConsumer(BrokerFilter.java:117)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.MutableBrokerFilter.removeConsumer(MutableBrokerFilter.java:123)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.removeConsumer(BrokerFilter.java:117)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.BrokerFilter.removeConsumer(BrokerFilter.java:117)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.MutableBrokerFilter.removeConsumer(MutableBrokerFilter.java:123)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.TransportConnection.processRemoveConsumer(TransportConnection.java:651)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.command.RemoveInfo.visit(RemoveInfo.java:76)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:329)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:184)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:288)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)[105:org.apache.activemq.activemq-osgi:5.8.0.redhat-60024]\n\tat java.lang.Thread.run(Unknown Source)[:1.6.0_26]\n{code}\n \n",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-5854.json",
        "creation_time": "2015-06-19T15:36:33.000+0000",
        "bug_report": {
            "Title": "Duplicate messages when failover is done during prepare phase of two phase commit.",
            "Description": "Use case :\n                With Spring DMLC, Read a jms message in a queue, produce a jms message in an output queue and write data in database.\n\nProblem description :\n\n                Due to hight CPU usage, the inactity monitor closes connections between clients and broker while 16 messages were processed.\n\n{noformat}\n2015-06-01 04:39:01,130 | WARN  | Transport Connection to: tcp://*** failed: org.apache.activemq.transport.InactivityIOException: Channel was inactive for too (>30000) long: tcp://*** | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ InactivityMonitor Worker\n{noformat}\n                15 messages are rolled back and redilevered to another consummer.\n\n                In the log we got 15 warnings :\n{noformat}\nActiveMQMessageConsumer   |WARN |jmsContainer-173|rolling back transaction (XID:***) post failover recovery. 1 previously delivered message(s) not replayed to consumer: ***\n{noformat}\n                But one message is not rolled back (the transaction commit) and is also redileverd to another consummer. So it's processed twice by two different consummers (two inserts in database and two output JMS messages generated) and is not deduplicated.\n\n                In the activeMq log we got the message :\n\n{noformat}\nWARN  | Async error occurred:  | org.apache.activemq.broker.TransportConnection.Service | ActiveMQ Transport: tcp:///***\n                       javax.jms.JMSException: Unmatched acknowledge: MessageAck {commandId = 6665, responseRequired = false, ackType = 2, consumerId = ID:***, firstMessageId = ID:***-50800-1433109620591-1:2:31356:1:1, lastMessageId = ID:***-50800-1433109620591-1:2:31356:1:1, destination = queue://***, transactionId = XID:[1096044365,globalId=47524f55505f3030303038736572766963657472616974656d656e7431363536373030343133,branchId=47524f55505f3030303038736572766963657472616974656d656e743137343737], messageCount = 1, poisonCause = null}; Could not find Message-ID ID:***-50800-1433109620591-1:2:31356:1:1 in dispatched-list (start of ack)\n{noformat}\n\n                For this duplicated message, the failover occur during prepare phase of commit :\n\n{noformat}\n[{2015/06/01 04:39:50,322 |FailoverTransport         |WARN |jmsContainer-152|Transport (tcp://***) failed, reason:  , attempting to automatically reconnect}]\norg.apache.activemq.transport.InactivityIOException: Cannot send, channel has already failed: ***\n                at org.apache.activemq.transport.AbstractInactivityMonitor.doOnewaySend(AbstractInactivityMonitor.java:297)\n                at org.apache.activemq.transport.AbstractInactivityMonitor.oneway(AbstractInactivityMonitor.java:286)\n                at org.apache.activemq.transport.TransportFilter.oneway(TransportFilter.java:85)\n                at org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:104)\n                at org.apache.activemq.transport.failover.FailoverTransport.oneway(FailoverTransport.java:658)\n                at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:68)\n                at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)\n                at org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1321)\n                at org.apache.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:1315)\n                at org.apache.activemq.ActiveMQSession.asyncSendPacket(ActiveMQSession.java:1933)\n                at org.apache.activemq.ActiveMQSession.sendAck(ActiveMQSession.java:2099)\n                at org.apache.activemq.ActiveMQSession.sendAck(ActiveMQSession.java:2094)\n                at org.apache.activemq.ActiveMQMessageConsumer.acknowledge(ActiveMQMessageConsumer.java:1083)\n                at org.apache.activemq.ActiveMQMessageConsumer$5.beforeEnd(ActiveMQMessageConsumer.java:1041)\n                at org.apache.activemq.TransactionContext.beforeEnd(TransactionContext.java:202)\n                at org.apache.activemq.TransactionContext.end(TransactionContext.java:409)\n                at com.atomikos.datasource.xa.XAResourceTransaction.suspend(XAResourceTransaction.java:457)\n                at com.atomikos.datasource.xa.XAResourceTransaction.prepare(XAResourceTransaction.java:608)\n                at com.atomikos.icatch.imp.PrepareMessage.send(PrepareMessage.java:61)\n                at com.atomikos.icatch.imp.PropagationMessage.submit(PropagationMessage.java:111)\n                at com.atomikos.icatch.imp.Propagator$PropagatorThread.run(Propagator.java:87)\n                at com.atomikos.icatch.imp.Propagator.submitPropagationMessage(Propagator.java:66)\n                at com.atomikos.icatch.imp.ActiveStateHandler.prepare(ActiveStateHandler.java:173)\n                at com.atomikos.icatch.imp.CoordinatorImp.prepare(CoordinatorImp.java:832)\n                at com.atomikos.icatch.imp.CoordinatorImp.terminate(CoordinatorImp.java:1159)\n                at com.atomikos.icatch.imp.CompositeTerminatorImp.commit(CompositeTerminatorImp.java:92)\n                at com.atomikos.icatch.jta.TransactionImp.commit(TransactionImp.java:236)\n                at com.atomikos.icatch.jta.TransactionManagerImp.commit(TransactionManagerImp.java:498)\n                at com.atomikos.icatch.jta.UserTransactionImp.commit(UserTransactionImp.java:129)\n                at org.springframework.transaction.jta.JtaTransactionManager.doCommit(JtaTransactionManager.java:1011)\n                at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:755)\n                at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:724)\n                at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:257)\n                at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1101)\n                at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:995)\n                at java.lang.Thread.run(Thread.java:761)\n{noformat}\n\nOur analysis :\n\n                We think that the duplicate message is caused by the failover during the prepare phase of the commit so we modify the source code to reproduce the case.\n\n                Our modifications in config to produce failovers:\n                               broker : transport.useKeepAlive=false\n                               client : wireFormat.maxInactivityDuration=5000\n\n\n                We add Thread.sleep in the source code of org.apache.activemq.ActiveMQMessageConsumer to force failover to be done exactly where we think it causes problems :\n\n{code:title=org.apache.activemq.ActiveMQMessageConsumer#acknowledge()|borderStyle=solid}                \n\n                    public void acknowledge() throws JMSException {\n                               clearDeliveredList();\n                               waitForRedeliveries();\n                               synchronized(deliveredMessages) {\n\n                                   // BEGIN MODIFIED CODE\n                                   LOG.warn(\"start sleeping 20 seconds to test failover\");\n                                   try{\n                                       Thread.sleep(1000 * 20 );\n                                   }catch (InterruptedException e){\n                                       LOG.error(\"Exception :\",e);\n                                   }\n                                   LOG.warn(\"end sleeping 20 seconds to test failover\");\n                                   // END MODIFIED CODE\n\n                                   // Acknowledge all messages so far.\n                                   MessageAck ack = makeAckForAllDeliveredMessages(MessageAck.STANDARD_ACK_TYPE);\n                                   if (ack == null)\n                                       return; // no msgs\n\n                                   if (session.getTransacted()) {\n                                       rollbackOnFailedRecoveryRedelivery();\n                                       session.doStartTransaction();\n                                       ack.setTransactionId(session.getTransactionContext().getTransactionId());\n                                   }\n\n                                   pendingAck = null;\n                                    session.sendAck(ack);\n\n                                   // Adjust the counters\n                                   deliveredCounter = Math.max(0, deliveredCounter - deliveredMessages.size());\n                                   additionalWindowSize = Math.max(0, additionalWindowSize - deliveredMessages.size());\n\n                                   if (!session.getTransacted()) {\n                                       deliveredMessages.clear();\n                                   }\n                               }\n                    }\n{code}                               \n                \n                With these changes on the configuration and the code, the problem is easily reproduced.\n\n                We also try with transactedIndividualAck=true, and we add a Thread.sleep in the code :\n\n{code:title=org.apache.activemq.ActiveMQMessageConsumer#registerSync()|borderStyle=solid}                \n                    private void registerSync() throws JMSException {\n                               session.doStartTransaction();\n                               if (!synchronizationRegistered) {\n                                   synchronizationRegistered = true;\n                                   session.getTransactionContext().addSynchronization(new Synchronization() {\n                                       @Override\n                                       public void beforeEnd() throws Exception {\n                                           if (transactedIndividualAck) {\n                                               clearDeliveredList();\n                                               waitForRedeliveries();\n                                               synchronized(deliveredMessages) {\n                                                   \n                                                   // BEGIN MODIFIED CODE\n                                                   LOG.warn(\"start sleeping 20 seconds to test failover\");\n                                                   try{\n                                                       Thread.sleep(1000 * 20 );\n                                                   }catch (InterruptedException e){\n                                                       LOG.error(\"Exception :\",e);\n                                                   }\n                                                   LOG.warn(\"end sleeping 20 seconds to test failover\");\n                                                   // END MODIFIED CODE                            \n\n                                                   rollbackOnFailedRecoveryRedelivery();\n                                               }\n                                           } else {\n                                               acknowledge();\n                                           }\n                                           synchronizationRegistered = false;\n                                       }\n\n                                       @Override\n                                       public void afterCommit() throws Exception {\n                                           commit();\n                                           synchronizationRegistered = false;\n                                       }\n\n                                       @Override\n                                       public void afterRollback() throws Exception {\n                                           rollback();\n                                           synchronizationRegistered = false;\n                                       }\n                                   });\n                               }\n                    }\n{code}                                               \n                With these modifications, we still get duplicates messages.\n\n                We think that the problem is that the statement synchronized(deliveredMessages) prevents the call of clearDeliveredList() by another ActiveMQConnection thread that clears messages in progress.\n                By adding logs we observe that a thread is waiting deliveredMessages \u2018s lock in clearDeliveredList() method.\n\n                \nQuestion :\n                \n                We tried fixes described in https://issues.apache.org/jira/browse/AMQ-5068 and https://issues.apache.org/jira/browse/AMQ-3519 but it doesn\u2019t help to solve our problem.\n                Is there a workaround or a config parameter that can help to prevent this problem ?\n                \n                We are working on our side to find a correction. An option may be to force rolling back transaction if there is a failover during the prepare phase of commit in ConnectionStateTracker.restoreTransactions().\n\n\n",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-3056.json",
        "creation_time": "2010-11-26T14:36:24.000+0000",
        "bug_report": {
            "Title": "Exception when Redelivery ack is processed by topic subscription",
            "Description": "2010-11-12 17:46:24,124 | WARN  | Async error occurred: javax.jms.JMSException: Invalid acknowledgment: MessageAck {commandId = 29455, responseRequired = false, ackType = 3, consumerId =ID:X-2506-1289583778418-0:0:1:1, firstMessageId =ID:X-51821-634249796434830099-1:5:1:3:313195, lastMessageId = ID:X-51821-634249796434830099-1:5:1:3:313195, destination = topic://help.Publish.Instance1, transactionId = null, messageCount = 1} | org.apache.activemq.broker.TransportConnection.Service | ActiveMQ Transport: tcp:///Y:2508\njavax.jms.JMSException: Invalid acknowledgment: MessageAck {commandId = 29455, responseRequired = false, ackType = 3, consumerId = ID:X-2506-1289583778418-0:0:1:1, firstMessageId = ID:X09-51821-634249796434830099-1:5:1:3:313195, lastMessageId = ID:X09-51821-634249796434830099-1:5:1:3:313195, destination = topic://help.Publish.Instance1, transactionId = null, messageCount = 1}\n        at org.apache.activemq.broker.region.TopicSubscription.acknowledge(TopicSubscription.java:286)\n        at org.apache.activemq.broker.region.AbstractRegion.acknowledge(AbstractRegion.java:383)\n        at org.apache.activemq.broker.region.RegionBroker.acknowledge(RegionBroker.java:544)\n        at org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:77)\n        at org.apache.activemq.broker.TransactionBroker.acknowledge(TransactionBroker.java:200)\n        at org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:77)\n        at org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:77)\n        at org.apache.activemq.broker.MutableBrokerFilter.acknowledge(MutableBrokerFilter.java:87)\n        at org.apache.activemq.broker.TransportConnection.processMessageAck(TransportConnection.java:469)\n        at org.apache.activemq.command.MessageAck.visit(MessageAck.java:214)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:311)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:185)\n        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)\n        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:228)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:220)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:202)\n        at java.lang.Thread.run(Thread.java:619)\n",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-3325.json",
        "creation_time": "2011-05-17T08:58:50.000+0000",
        "bug_report": {
            "Title": "PList temp store,  chunk stream does not exist when broker under stress",
            "Description": "apparent concurrency issue, multicore (8 cpu) under load, sporadic occurrence, related to memory limits and dynamic destination creation/deletion. Broker stack trace:\n{code}2011-04-07 08:04:07,295 [Queue:loadq-4  ] ERROR FilePendingMessageCursor       - I/O error\njava.io.EOFException: Chunk stream does not exist at page: 198\n\tat org.apache.kahadb.page.Transaction$2.readPage(Transaction.java:454)\n\tat org.apache.kahadb.page.Transaction$2.<init>(Transaction.java:431)\n\tat org.apache.kahadb.page.Transaction.openInputStream(Transaction.java:428)\n\tat org.apache.kahadb.page.Transaction.load(Transaction.java:404)\n\tat org.apache.kahadb.page.Transaction.load(Transaction.java:361)\n\tat org.apache.activemq.store.kahadb.plist.PList.loadEntry(PList.java:468)\n\tat org.apache.activemq.store.kahadb.plist.PList.getNext(PList.java:483)\n\tat org.apache.activemq.store.kahadb.plist.PList$10.execute(PList.java:312)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:728)\n\tat org.apache.activemq.store.kahadb.plist.PList.getNext(PList.java:310)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor$DiskIterator.next(FilePendingMessageCursor.java:500)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor$DiskIterator.next(FilePendingMessageCursor.java:473)\n\tat org.apache.activemq.broker.region.cursors.FilePendingMessageCursor.next(FilePendingMessageCursor.java:293)\n\tat org.apache.activemq.broker.region.Queue.doPageInForDispatch(Queue.java:1714)\n\tat org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1932)\n\tat org.apache.activemq.broker.region.Queue.iterate(Queue.java:1440)\n\tat org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:104)\n\tat org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:42){code}",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-2963.json",
        "creation_time": "2010-10-07T06:52:51.000+0000",
        "bug_report": {
            "Title": "JMSBridgeConnectors does not work with IBM MQ and ActiveMQ 5.4.0",
            "Description": "We are trying to create a bridge with IBM Websphere Queue and ActiveMQ queue. We have defined a broker in activemq.xml with following jmsBridgeConnectors information:\n\n<jmsBridgeConnectors>\n    <jmsQueueConnector\n      outboundQueueConnectionFactory=\"#remoteFactory\">\n      <inboundQueueBridges>\n        <inboundQueueBridge inboundQueueName=\"IBM.TO.ACTIVEMQ\" localQueueName=\"IBM.TO.ACTIVEMQ\"/>\n      </inboundQueueBridges>\n   </jmsQueueConnector>\n</jmsBridgeConnectors>\n\nWe are getting below error with activemq 5.4.0 and it works fine with version 5.2.0:\n\ncom.ibm.msg.client.jms.DetailedInvalidDestinationException: JMSCMQ0005: The destination name '://IBM.TO.ACTIVEMQ' was not valid. The destination name specified does not conform to published destination syntax. Correct the specified destination name and try again.\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)\n        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)\n        at java.lang.reflect.Constructor.newInstance(Constructor.java:513)\n        at com.ibm.msg.client.commonservices.j2se.NLSServices.createException(NLSServices.java:313)\n        at com.ibm.msg.client.commonservices.nls.NLSServices.createException(NLSServices.java:388)\n        at com.ibm.msg.client.wmq.common.internal.WMQDestinationURIParser.setUri(WMQDestinationURIParser.java:524)\n        at com.ibm.msg.client.wmq.common.internal.WMQDestination.<init>(WMQDestination.java:3148)\n        at com.ibm.msg.client.wmq.common.internal.WMQDestination.<init>(WMQDestination.java:3104)\n        at com.ibm.msg.client.wmq.factories.WMQFactoryFactory.createProviderDestination(WMQFactoryFactory.java:444)\n        at com.ibm.msg.client.jms.admin.JmsDestinationImpl.setProviderDestination(JmsDestinationImpl.java:333)\n        at com.ibm.msg.client.jms.admin.JmsDestinationImpl.initialise(JmsDestinationImpl.java:231)\n        at com.ibm.msg.client.jms.admin.JmsDestinationImpl.<init>(JmsDestinationImpl.java:196)\n        at com.ibm.msg.client.jms.admin.JmsJndiDestinationImpl.<init>(JmsJndiDestinationImpl.java:129)\n        at com.ibm.mq.jms.MQDestination.<init>(MQDestination.java:186)\n        at com.ibm.msg.client.wmq.factories.admin.WMQJmsFactory.createDestination(WMQJmsFactory.java:125)\n        at com.ibm.msg.client.jms.internal.JmsMessageImpl.providerDestToJmsDest(JmsMessageImpl.java:2111)\n        at com.ibm.msg.client.jms.internal.JmsMessageImpl.getJMSDestination(JmsMessageImpl.java:686)\n        at com.ibm.jms.JMSMessage.getJMSDestination(JMSMessage.java:605)\n        at org.apache.activemq.ActiveMQMessageTransformation.copyProperties(ActiveMQMessageTransformation.java:206)\n        at org.apache.activemq.ActiveMQMessageTransformation.transformMessage(ActiveMQMessageTransformation.java:188)\n        at org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1720)\n        at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:231)\n        at org.apache.activemq.ActiveMQMessageProducerSupport.send(ActiveMQMessageProducerSupport.java:300)\n        at org.apache.activemq.ActiveMQQueueSender.send(ActiveMQQueueSender.java:111)\n        at org.apache.activemq.network.jms.QueueBridge.sendMessage(QueueBridge.java:80)\n        at org.apache.activemq.network.jms.DestinationBridge.onMessage(DestinationBridge.java:129)\n        at com.ibm.mq.jms.MQMessageConsumer$FacadeMessageListener.onMessage(MQMessageConsumer.java:399)\n        at com.ibm.msg.client.jms.internal.JmsMessageConsumerImpl$JmsProviderMessageListener.onMessage(JmsMessageConsumerImpl.java:904)\n        at com.ibm.msg.client.wmq.internal.WMQAsyncConsumerShadow.honourNoLocal(WMQAsyncConsumerShadow.java:550)\n        at com.ibm.msg.client.wmq.internal.WMQAsyncConsumerShadow.consumer(WMQAsyncConsumerShadow.java:384)\n        at com.ibm.mq.jmqi.remote.internal.RemoteAsyncConsume.driveConsumer(RemoteAsyncConsume.java:1478)\n        at com.ibm.mq.jmqi.remote.internal.RemoteDispatchThread.run(RemoteDispatchThread.java:385)\n        at com.ibm.msg.client.commonservices.workqueue.WorkQueueItem.runTask(WorkQueueItem.java:209)\n        at com.ibm.msg.client.commonservices.workqueue.SimpleWorkQueueItem.runItem(SimpleWorkQueueItem.java:100)\n        at com.ibm.msg.client.commonservices.workqueue.WorkQueueItem.run(WorkQueueItem.java:224)\n        at com.ibm.msg.client.commonservices.workqueue.WorkQueueManager.runWorkQueueItem(WorkQueueManager.java:298)\n        at com.ibm.msg.client.commonservices.j2se.workqueue.WorkQueueManagerImplementation$ThreadPoolWorker.run(WorkQueueManagerImplementation.java:1220)\n\nI looked at the code for class ActiveMQsession has a method send which was modified after v 5.2.0 and below lines of code were moved before transforming the IBM JMS Message to Active MQ message:\n            message.setJMSDestination(destination);\n            message.setJMSDeliveryMode(deliveryMode);\n            long expiration = 0L;\n            if (!producer.getDisableMessageTimestamp()) {\n                long timeStamp = System.currentTimeMillis();\n                message.setJMSTimestamp(timeStamp);\n                if (timeToLive > 0) {\n                    expiration = timeToLive + timeStamp;\n                }\n            }\n            message.setJMSExpiration(expiration);\n            message.setJMSPriority(priority);\n            message.setJMSRedelivered(false);\n\nNow code sets the ActiveMQDestination as the JMS destination to IBM Message before transformation and we are getting above error when JMS properties are getting copied from IBM Message to ActiveMQMessage inside ActiveMQMessageTransformation.",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-3903.json",
        "creation_time": "2012-06-28T14:09:35.000+0000",
        "bug_report": {
            "Title": "Failed to fire fast producer advisory, reason: java.lang.NullPointerException",
            "Description": "When sending a lot of Messages to Queue via Webconsole and advisdoryForFastProducers=\"true\" (so the advisory triggers)\na exception occurs:\n\njvm 1    |  WARN | Failed to fire fast producer advisory, reason: java.lang.NullPointerException\n\n2012-07-12 11:40:48,623 | DEBUG | fast producer detail | org.apache.activemq.advisory.AdvisoryBroker | VMTransport: vm://localhost#1\njava.lang.NullPointerException\n\tat org.apache.activemq.advisory.AdvisorySupport.getFastProducerAdvisoryTopic(AdvisorySupport.java:195)\n\tat org.apache.activemq.advisory.AdvisoryBroker.fastProducer(AdvisoryBroker.java:352)\n\tat org.apache.activemq.broker.BrokerFilter.fastProducer(BrokerFilter.java:275)\n\tat org.apache.activemq.broker.BrokerFilter.fastProducer(BrokerFilter.java:275)\n\tat org.apache.activemq.broker.MutableBrokerFilter.fastProducer(MutableBrokerFilter.java:286)\n\tat org.apache.activemq.broker.region.BaseDestination.fastProducer(BaseDestination.java:512)\n\tat org.apache.activemq.broker.region.Queue.send(Queue.java:605)\n\tat org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:407)\n\tat org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:503)\n\tat org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:305)\n\tat org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)\n\tat org.apache.activemq.broker.scheduler.SchedulerBroker.send(SchedulerBroker.java:189)\n\tat org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:129)\n\tat org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n\tat org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:306)\n\tat org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:135)\n\tat org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:453)\n\tat org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:681)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:292)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:150)\n\tat org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)\n\tat org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n\tat org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:231)\n\tat org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)\n\tat org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-2693.json",
        "creation_time": "2010-04-12T13:58:58.000+0000",
        "bug_report": {
            "Title": "potential hang with failover, transactions and slow thread creation with outstanding commit - close blocks pending dispatch  FailoverConsumerOutstandingCommitTest intermittent failure",
            "Description": "potential dead lock pending dispatch that is blocked by an outstanding commit after failover.\n\nLog indicates:{code}\nWARN  ActiveMQConnection             - dispatch paused, waiting for outstanding dispatch interruption processing (x) to complete..\n{code}\n\n\nThread Dump:{code}\nFull thread dump Java HotSpot(TM) Server VM (14.0-b16 mixed mode):\n...\n\"ActiveMQ Transport: tcp:///127.0.0.1:49284\" daemon prio=3 tid=0x0068f800 nid=0x32 runnable [0x56ffe000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.SocketOutputStream.socketWrite0(Native Method)\n\tat java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)\n\tat java.net.SocketOutputStream.write(SocketOutputStream.java:136)\n\tat org.apache.activemq.transport.tcp.TcpBufferedOutputStream.flush(TcpBufferedOutputStream.java:115)\n\tat java.io.DataOutputStream.flush(DataOutputStream.java:106)\n\tat org.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:168)\n\tat org.apache.activemq.transport.InactivityMonitor.oneway(InactivityMonitor.java:243)\n\t- locked <0x5c2daab0> (a java.util.concurrent.atomic.AtomicBoolean)\n\tat org.apache.activemq.transport.TransportFilter.oneway(TransportFilter.java:83)\n\tat org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:104)\n\tat org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)\n\t- locked <0x5c2da520> (a java.lang.Object)\n\tat org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1205)\n\tat org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:790)\n\tat org.apache.activemq.broker.TransportConnection.dispatchSync(TransportConnection.java:750)\n\tat org.apache.activemq.broker.region.PrefetchSubscription.dispatch(PrefetchSubscription.java:647)\n\tat org.apache.activemq.broker.region.PrefetchSubscription.dispatchPending(PrefetchSubscription.java:592)\n\t- locked <0x5c2db3a0> (a java.lang.Object)\n\t- locked <0x5c2db3a8> (a java.lang.Object)\n\tat org.apache.activemq.broker.region.PrefetchSubscription.add(PrefetchSubscription.java:158)\n\tat org.apache.activemq.broker.region.Queue.doActualDispatch(Queue.java:1548)\n\tat org.apache.activemq.broker.region.Queue.doDispatch(Queue.java:1500)\n\t- locked <0x5c2db500> (a java.util.ArrayList)\n\t- locked <0x5c2db518> (a java.lang.Object)\n\tat org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1585)\n\tat org.apache.activemq.broker.region.Queue.iterate(Queue.java:1219)\n\t- locked <0x5c2db520> (a org.apache.activemq.broker.region.Queue$3)\n\tat org.apache.activemq.broker.region.Queue.wakeup(Queue.java:1406)\n\tat org.apache.activemq.broker.region.Queue.addSubscription(Queue.java:377)\n\tat org.apache.activemq.broker.region.AbstractRegion.addConsumer(AbstractRegion.java:279)\n\t- locked <0x5c2db590> (a java.lang.Object)\n\tat org.apache.activemq.broker.region.RegionBroker.addConsumer(RegionBroker.java:380)\n\tat org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:86)\n\tat org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:86)\n\tat org.apache.activemq.advisory.AdvisoryBroker.addConsumer(AdvisoryBroker.java:89)\n\tat org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:86)\n\tat org.apache.activemq.broker.MutableBrokerFilter.addConsumer(MutableBrokerFilter.java:93)\n\tat org.apache.activemq.broker.TransportConnection.processAddConsumer(TransportConnection.java:533)\n\tat org.apache.activemq.command.ConsumerInfo.visit(ConsumerInfo.java:349)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:300)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:178)\n\tat org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\n\tat org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n\tat org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:216)\n\t- locked <0x5c2dab30> (a org.apache.activemq.transport.InactivityMonitor$1)\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:204)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:186)\n\tat java.lang.Thread.run(Thread.java:619)\n\n\"ActiveMQ Transport: tcp://localhost/127.0.0.1:61616\" prio=3 tid=0x007c9000 nid=0x2e waiting on condition [0x569fe000]\n   java.lang.Thread.State: TIMED_WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x5c2b1950> (a java.util.concurrent.CountDownLatch$Sync)\n\tat java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:198)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedNanos(AbstractQueuedSynchronizer.java:947)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.tryAcquireSharedNanos(AbstractQueuedSynchronizer.java:1239)\n\tat java.util.concurrent.CountDownLatch.await(CountDownLatch.java:253)\n\tat org.apache.activemq.ActiveMQConnection.waitForTransportInterruptionProcessing(ActiveMQConnection.java:2248)\n\tat org.apache.activemq.ActiveMQConnection$2.processMessageDispatch(ActiveMQConnection.java:1679)\n\tat org.apache.activemq.command.MessageDispatch.visit(MessageDispatch.java:108)\n\tat org.apache.activemq.ActiveMQConnection.onCommand(ActiveMQConnection.java:1676)\n\tat org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)\n\tat org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)\n\tat org.apache.activemq.transport.failover.FailoverTransport$3.onCommand(FailoverTransport.java:168)\n\tat org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n\tat org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:216)\n\t- locked <0x5c2db138> (a org.apache.activemq.transport.InactivityMonitor$1)\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:204)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:186)\n\tat java.lang.Thread.run(Thread.java:619)\n\n\n\"ActiveMQ Session Task\" prio=3 tid=0x0076f000 nid=0x25 waiting on condition [0x55ffe000]\n   java.lang.Thread.State: WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x5c2e3cd0> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\n\tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:1925)\n\tat java.util.concurrent.ArrayBlockingQueue.take(ArrayBlockingQueue.java:317)\n\tat org.apache.activemq.transport.FutureResponse.getResult(FutureResponse.java:40)\n\tat org.apache.activemq.transport.ResponseCorrelator.request(ResponseCorrelator.java:87)\n\tat org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1262)\n\tat org.apache.activemq.TransactionContext.syncSendPacketWithInterruptionHandling(TransactionContext.java:666)\n\tat org.apache.activemq.TransactionContext.commit(TransactionContext.java:299)\n\tat org.apache.activemq.ActiveMQSession.commit(ActiveMQSession.java:558)\n\tat org.apache.activemq.transport.failover.FailoverConsumerOutstandingCommitTest$2.onMessage(FailoverConsumerOutstandingCommitTest.java:155)\n\tat org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:1204)\n\t- locked <0x5c2c6088> (a java.lang.Object)\n\tat org.apache.activemq.ActiveMQSessionExecutor.dispatch(ActiveMQSessionExecutor.java:131)\n\tat org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:202)\n\tat org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:122)\n\tat org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:43)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:619)\n\n\n\"ActiveMQ Scheduler\" daemon prio=3 tid=0x006e4c00 nid=0xf waiting for monitor entry [0x573ff000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n\tat org.apache.activemq.ActiveMQMessageConsumer.clearMessagesInProgress(ActiveMQMessageConsumer.java:661)\n\t- waiting to lock <0x5c2c6088> (a java.lang.Object)\n\tat org.apache.activemq.ActiveMQSession$2.run(ActiveMQSession.java:654)\n\tat org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)\n\tat java.util.TimerThread.mainLoop(Timer.java:512)\n\tat java.util.TimerThread.run(Timer.java:462)\n\n\"main\" prio=3 tid=0x00030800 nid=0x2 waiting for monitor entry [0x7eb7d000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n\tat org.apache.activemq.MessageDispatchChannel.stop(MessageDispatchChannel.java:115)\n\t- waiting to lock <0x5c2c6088> (a java.lang.Object)\n\tat org.apache.activemq.ActiveMQMessageConsumer.stop(ActiveMQMessageConsumer.java:1312)\n\tat org.apache.activemq.ActiveMQSession.stop(ActiveMQSession.java:1643)\n\tat org.apache.activemq.ActiveMQConnection.stop(ActiveMQConnection.java:544)\n\t- locked <0x5c2ae5d8> (a java.util.concurrent.CopyOnWriteArrayList)\n\tat org.apache.activemq.ActiveMQConnection.close(ActiveMQConnection.java:597)\n\tat org.apache.activemq.transport.failover.FailoverConsumerOutstandingCommitTest.doTestFailoverConsumerDups(FailoverConsumerOutstandingCommitTest.java:185)\n\tat org.apache.activemq.transport.failover.FailoverConsumerOutstandingCommitTest.testFailoverConsumerDups(FailoverConsumerOutstandingCommitTest.java:104)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:73)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:46)\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:180)\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:41)\n\tat org.junit.runners.ParentRunner$1.evaluate(ParentRunner.java:173)\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:220)\n\tat org.apache.maven.surefire.junit4.JUnit4TestSet.execute(JUnit4TestSet.java:62)\n\tat org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet(AbstractDirectoryTestSuite.java:140)\n\tat org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(AbstractDirectoryTestSuite.java:165)\n\tat org.apache.maven.surefire.Surefire.run(Surefire.java:107)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess(SurefireBooter.java:289)\n\tat org.apache.maven.surefire.booter.SurefireBooter.main(SurefireBooter.java:1005)\n{code}",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-4643.json",
        "creation_time": "2013-07-19T13:39:19.000+0000",
        "bug_report": {
            "Title": "JDBCPersistence DB stopped during message send with JDBCIOExceptionHandler configured; IOException/SQLException is sent back (sometimes) to the client before the transport connector is shutdown",
            "Description": "This related to AMQ-4636 JIRA for gtully's second point in comment https://issues.apache.org/jira/browse/AMQ-4636?focusedCommentId=13712196&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13712196\n\nScenario:\n- Producer sending persistent message (no transaction)\n- JDBCIOExceptionHandler is configured \n- the underlying DB is shutdown during message send\n\nResult:\nOne of two outcomes can happen:\n1) the broker sends the an IOException/SQLException wrapped in a JMSException (below) back to the client and then shuts down the transport connectors.\n2) the broker shuts down the transport connector when the IOException/SQLException is encountered.\n\nExpected behavior:\nAs the JDBCIOHandler is configured which is handling the SQL exception, it would be good if the transport connectors were shutdown and no IOException/SQLException is reported to producer.\n\n{code}\n2013-07-19 15:22:05,436 [main           ] - ERROR pDBDuringProducerSendTopicTest - unexpected exception caught\njavax.jms.JMSException: Database &apos;target/derbydb_15&apos; not found.\n\tat org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:54)\n\tat org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1391)\n\tat org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1319)\n\tat org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1809)\n\tat org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:289)\n\tat org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:224)\n\tat org.apache.activemq.ActiveMQMessageProducerSupport.send(ActiveMQMessageProducerSupport.java:241)\n\tat org.apache.activemq.store.jdbc.StopDBDuringProducerSendTopicTest.sendMessage(StopDBDuringProducerSendTopicTest.java:150)\n\tat org.apache.activemq.store.jdbc.StopDBDuringProducerSendTopicTest.testProducerWithDBShutdown(StopDBDuringProducerSendTopicTest.java:127)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat junit.framework.TestCase.runTest(TestCase.java:176)\n\tat junit.framework.TestCase.runBare(TestCase.java:141)\n\tat junit.framework.TestResult$1.protect(TestResult.java:122)\n\tat junit.framework.TestResult.runProtected(TestResult.java:142)\n\tat junit.framework.TestResult.run(TestResult.java:125)\n\tat junit.framework.TestCase.run(TestCase.java:129)\n\tat junit.framework.TestSuite.runTest(TestSuite.java:255)\n\tat junit.framework.TestSuite.run(TestSuite.java:250)\n\tat org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:84)\n\tat org.apache.maven.surefire.junit4.JUnit4TestSet.execute(JUnit4TestSet.java:53)\n\tat org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:123)\n\tat org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:104)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:164)\n\tat org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:110)\n\tat org.apache.maven.surefire.booter.SurefireStarter.invokeProvider(SurefireStarter.java:175)\n\tat org.apache.maven.surefire.booter.SurefireStarter.runSuitesInProcessWhenForked(SurefireStarter.java:81)\n\tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:68)\nCaused by: java.io.IOException: Database &apos;target/derbydb_15&apos; not found.\n\tat org.apache.activemq.util.IOExceptionSupport.create(IOExceptionSupport.java:45)\n\tat org.apache.activemq.store.jdbc.TransactionContext.getConnection(TransactionContext.java:68)\n\tat org.apache.activemq.store.jdbc.adapter.DefaultJDBCAdapter.doAddMessage(DefaultJDBCAdapter.java:218)\n\tat org.apache.activemq.store.jdbc.JDBCMessageStore.addMessage(JDBCMessageStore.java:123)\n\tat org.apache.activemq.store.memory.MemoryTransactionStore.addMessage(MemoryTransactionStore.java:327)\n\tat org.apache.activemq.store.memory.MemoryTransactionStore$2.asyncAddTopicMessage(MemoryTransactionStore.java:190)\n\tat org.apache.activemq.broker.region.Topic.doMessageSend(Topic.java:482)\n\tat org.apache.activemq.broker.region.Topic.send(Topic.java:446)\n\tat org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:406)\n\tat org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:431)\n\tat org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:147)\n\tat org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n\tat org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:317)\n\tat org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:152)\n\tat org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:464)\n\tat org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:751)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:294)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:149)\n\tat org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n\tat org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n\tat org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:288)\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n\tat java.lang.Thread.run(Thread.java:680)\nCaused by: java.sql.SQLException: Database &apos;target/derbydb_15&apos; not found.\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)\n\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)\n\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)\n\tat org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedConnection.newSQLException(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedConnection.handleDBNotFound(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedConnection40.&lt;init&gt;(Unknown Source)\n\tat org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Unknown Source)\n\tat org.apache.derby.jdbc.InternalDriver.connect(Unknown Source)\n\tat org.apache.derby.jdbc.EmbeddedDataSource.getConnection(Unknown Source)\n\tat org.apache.derby.jdbc.EmbeddedDataSource.getConnection(Unknown Source)\n\tat org.apache.activemq.store.jdbc.StopDBDuringProducerSendTopicTest$ReconnectingEmbeddedDataSource.getConnection(StopDBDuringProducerSendTopicTest.java:242)\n\tat org.apache.activemq.store.jdbc.TransactionContext.getConnection(TransactionContext.java:58)\n\t... 23 more\nCaused by: java.lang.Throwable: org.apache.derby.impl.jdbc.EmbedSQLException: Database &apos;target/derbydb_15&apos; not found.\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)\n\t... 38 more\n{code}",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-2902.json",
        "creation_time": "2010-09-07T11:34:15.000+0000",
        "bug_report": {
            "Title": "ResourceAdapter logs confusing Exception upon pool connection disposal",
            "Description": "After upgrading to 5.4.0 we see many exceptions of the following kind being logged with level INFO:\n{quote}\n2010-09-07 13:23:25,824 INFO  [org.apache.activemq.broker.TransportConnection.Transport] Transport failed: org.apache.activemq.transport.TransportDisposedIOException: Peer (vm://caa.embedded?waitForStart=300000&async=false#13) disposed.\norg.apache.activemq.transport.TransportDisposedIOException: Peer (vm://caa.embedded?waitForStart=300000&async=false#13) disposed.\n\tat org.apache.activemq.transport.vm.VMTransport.stop(VMTransport.java:159)\n\tat org.apache.activemq.transport.vm.VMTransportServer$1.stop(VMTransportServer.java:81)\n\tat org.apache.activemq.transport.TransportFilter.stop(TransportFilter.java:65)\n\tat org.apache.activemq.transport.TransportFilter.stop(TransportFilter.java:65)\n\tat org.apache.activemq.transport.ResponseCorrelator.stop(ResponseCorrelator.java:132)\n\tat org.apache.activemq.util.ServiceSupport.dispose(ServiceSupport.java:43)\n\tat org.apache.activemq.ActiveMQConnection.close(ActiveMQConnection.java:656)\n\tat org.apache.activemq.ra.ActiveMQManagedConnection.destroy(ActiveMQManagedConnection.java:207)\n\tat org.jboss.resource.connectionmanager.InternalManagedConnectionPool.doDestroy(InternalManagedConnectionPool.java:650)\n\tat org.jboss.resource.connectionmanager.InternalManagedConnectionPool.removeTimedOut(InternalManagedConnectionPool.java:481)\n\tat org.jboss.resource.connectionmanager.IdleRemover$IdleRemoverRunnable.run(IdleRemover.java:164)\n\tat java.lang.Thread.run(Thread.java:619)\n{quote}\nI suppose that the cause for the message is actually harmless - hence the INFO level - but the messages are confusing and annoying nonetheless.",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-5665.json",
        "creation_time": "2015-03-16T21:35:15.000+0000",
        "bug_report": {
            "Title": "memory store is broken in 5.11.0 for advisories (and probably other issues as well)",
            "Description": "We're running 5.10.2 and don't encounter this issue.  We're running a non-persistent broker in production and testing so that's why we found this issue.\n\nIt looks like 5.11.0 introduced this issue.\n\nEssentially Advisories fail to fire. \n\nIt looks like it\u2019s a bug with MemoryTransactionStore. Switching to persistent brokers fixes the problem.\n\nIt\u2019s because addMessage calls:\n\n        } else {\n            destination.addMessage(null, message);\n        }\n\n.. with an explicit null.\n\nthe message given is:\n\n2015-03-16 12:54:17,538 WARN [ActiveMQ Transport: tcp:///127.0.0.1:56468@16161] org.apache.activemq.advisory.AdvisoryBroker Failed to fire delivered advisory, reason: java.lang.NullPointerException\n\n\u2026 and I saw this when I was running mvn test in the main ActiveMQ test suite (or at least pretty sure I did) so this is happening not just in my code. \n\nThe full exception , which I captured by setting a break point is below. \n\n\njava.lang.NullPointerException\n\tat org.apache.activemq.advisory.AdvisoryBroker.fireAdvisory(AdvisoryBroker.java:626)\n\tat org.apache.activemq.advisory.AdvisoryBroker.messageDelivered(AdvisoryBroker.java:397)\n\tat org.apache.activemq.broker.BrokerFilter.messageDelivered(BrokerFilter.java:349)\n\tat org.apache.activemq.broker.BrokerFilter.messageDelivered(BrokerFilter.java:349)\n\tat org.apache.activemq.broker.MutableBrokerFilter.messageDelivered(MutableBrokerFilter.java:360)\n\tat org.apache.activemq.broker.MutableBrokerFilter.messageDelivered(MutableBrokerFilter.java:360)\n\tat org.apache.activemq.broker.region.BaseDestination.messageDelivered(BaseDestination.java:518)\n\tat org.apache.activemq.broker.region.Queue.messageSent(Queue.java:1806)\n\tat org.apache.activemq.broker.region.Queue.doPendingCursorAdditions(Queue.java:794)\n\tat org.apache.activemq.broker.region.Queue.orderedCursorAdd(Queue.java:875)\n\tat org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:854)\n\tat org.apache.activemq.broker.region.Queue.send(Queue.java:733)\n\tat org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:419)\n\tat org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:468)\n\tat org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:297)\n\tat org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:152)\n\tat org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)\n\tat org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:307)\n\tat org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:157)\n\tat org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:157)\n\tat org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:541)\n\tat org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:768)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:334)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:188)\n\tat org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n\tat org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n\tat org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:270)\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n\tat java.lang.Thread.run(Thread.java:724)\n\n... the core issue here looks like the message doesn't have a TransactionId and MemoryTransactionStore has an addMessages which has a fall through of addMessage with a null context which then causes the NPE.\n\nDid messages have an implicit transaction Id before?\n",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-3725.json",
        "creation_time": "2012-02-17T18:57:21.000+0000",
        "bug_report": {
            "Title": "Kahadb error during SAN failover delayed write - Allow kahaDB to recover in a similar manner as the JDBC store using the IOExceptionHandler",
            "Description": "An issue can arise that causes the broker to terminate when using kahaDB with a SAN, when the SAN fails over.  In this case the failover process is seamless however, on fail back there is a 2-3 sec delay where writes are blocked and the broker terminates.  With the JDBC datastore a similar situation can be handled by using the IOExceptionHandler.  However with kahaDB, when this same IOExceptionHandler is added it prevents the broker from terminating but kahaDB retains an invalid index.\n\n{code}\n INFO | ActiveMQ JMS Message Broker (Broker1, ID:macbookpro-251a.home-56915-1328715089252-0:1) started\n INFO | jetty-7.1.6.v20100715\n INFO | ActiveMQ WebConsole initialized.\n INFO | Initializing Spring FrameworkServlet 'dispatcher'\n INFO | ActiveMQ Console at http://0.0.0.0:8161/admin\n INFO | ActiveMQ Web Demos at http://0.0.0.0:8161/demo\n INFO | RESTful file access application at http://0.0.0.0:8161/fileserver\n INFO | FUSE Web Console at http://0.0.0.0:8161/console\n INFO | Started SelectChannelConnector@0.0.0.0:8161\nERROR | KahaDB failed to store to Journal\njava.io.SyncFailedException: sync failed\n\tat java.io.FileDescriptor.sync(Native Method)\n\tat org.apache.kahadb.journal.DataFileAppender.processQueue(DataFileAppender.java:382)\n\tat org.apache.kahadb.journal.DataFileAppender$2.run(DataFileAppender.java:203)\n INFO | Ignoring IO exception, java.io.SyncFailedException: sync failed\njava.io.SyncFailedException: sync failed\n\tat java.io.FileDescriptor.sync(Native Method)\n\tat org.apache.kahadb.journal.DataFileAppender.processQueue(DataFileAppender.java:382)\n\tat org.apache.kahadb.journal.DataFileAppender$2.run(DataFileAppender.java:203)\nERROR | Checkpoint failed\njava.io.SyncFailedException: sync failed\n\tat java.io.FileDescriptor.sync(Native Method)\n\tat org.apache.kahadb.journal.DataFileAppender.processQueue(DataFileAppender.java:382)\n\tat org.apache.kahadb.journal.DataFileAppender$2.run(DataFileAppender.java:203)\n INFO | Ignoring IO exception, java.io.SyncFailedException: sync failed\njava.io.SyncFailedException: sync failed\n\tat java.io.FileDescriptor.sync(Native Method)\n\tat org.apache.kahadb.journal.DataFileAppender.processQueue(DataFileAppender.java:382)\n\tat org.apache.kahadb.journal.DataFileAppender$2.run(DataFileAppender.java:203)\nERROR | KahaDB failed to store to Journal\njava.io.FileNotFoundException: /Volumes/NAS-01/data/kahadb/db-1.log (No such file or directory)\n\tat java.io.RandomAccessFile.open(Native Method)\n\tat java.io.RandomAccessFile.<init>(RandomAccessFile.java:216)\n\tat org.apache.kahadb.journal.DataFile.openRandomAccessFile(DataFile.java:70)\n\tat org.apache.kahadb.journal.DataFileAppender.processQueue(DataFileAppender.java:324)\n\tat org.apache.kahadb.journal.DataFileAppender$2.run(DataFileAppender.java:203)\n INFO | Ignoring IO exception, java.io.FileNotFoundException: /Volumes/NAS-01/data/kahadb/db-1.log (No such file or directory)\njava.io.FileNotFoundException: /Volumes/NAS-01/data/kahadb/db-1.log (No such file or directory)\n\tat java.io.RandomAccessFile.open(Native Method)\n\tat java.io.RandomAccessFile.<init>(RandomAccessFile.java:216)\n\tat org.apache.kahadb.journal.DataFile.openRandomAccessFile(DataFile.java:70)\n\tat org.apache.kahadb.journal.DataFileAppender.processQueue(DataFileAppender.java:324)\n\tat org.apache.kahadb.journal.DataFileAppender$2.run(DataFileAppender.java:203)\nERROR | KahaDB failed to store to Journal\njava.io.FileNotFoundException: /Volumes/NAS-01/data/kahadb/db-1.log (No such file or directory)\n\tat java.io.RandomAccessFile.open(Native Method)\n\tat java.io.RandomAccessFile.<init>(RandomAccessFile.java:216)\n\tat org.apache.kahadb.journal.DataFile.openRandomAccessFile(DataFile.java:70)\n\tat org.apache.kahadb.journal.DataFileAppender.processQueue(DataFileAppender.java:324)\n\tat org.apache.kahadb.journal.DataFileAppender$2.run(DataFileAppender.java:203)\n INFO | Ignoring IO exception, java.io.FileNotFoundException: /Volumes/NAS-01/data/kahadb/db-1.log (No such file or directory)\njava.io.FileNotFoundException: /Volumes/NAS-01/data/kahadb/db-1.log (No such file or directory)\n\tat java.io.RandomAccessFile.open(Native Method)\n\tat java.io.RandomAccessFile.<init>(RandomAccessFile.java:216)\n\tat org.apache.kahadb.journal.DataFile.openRandomAccessFile(DataFile.java:70)\n\tat org.apache.kahadb.journal.DataFileAppender.processQueue(DataFileAppender.java:324)\n\tat org.apache.kahadb.journal.DataFileAppender$2.run(DataFileAppender.java:203)\n WARN | Transport failed: java.io.EOFException\n WARN | Transport failed: java.io.EOFException\n INFO | KahaDB: Recovering checkpoint thread after death\nERROR | Checkpoint failed\njava.io.IOException: Input/output error\n\tat java.io.RandomAccessFile.write(Native Method)\n\tat java.io.RandomAccessFile.writeLong(RandomAccessFile.java:1001)\n\tat org.apache.kahadb.page.PageFile.writeBatch(PageFile.java:1006)\n\tat org.apache.kahadb.page.PageFile.flush(PageFile.java:484)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1290)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$10.execute(MessageDatabase.java:768)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:760)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointCleanup(MessageDatabase.java:766)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$3.run(MessageDatabase.java:315)\n INFO | Ignoring IO exception, java.io.IOException: Input/output error\njava.io.IOException: Input/output error\n\tat java.io.RandomAccessFile.write(Native Method)\n\tat java.io.RandomAccessFile.writeLong(RandomAccessFile.java:1001)\n\tat org.apache.kahadb.page.PageFile.writeBatch(PageFile.java:1006)\n\tat org.apache.kahadb.page.PageFile.flush(PageFile.java:484)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1290)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$10.execute(MessageDatabase.java:768)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:760)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointCleanup(MessageDatabase.java:766)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$3.run(MessageDatabase.java:315)\n INFO | KahaDB: Recovering checkpoint thread after death\nERROR | Checkpoint failed\njava.io.IOException: Input/output error\n\tat java.io.RandomAccessFile.write(Native Method)\n\tat java.io.RandomAccessFile.writeLong(RandomAccessFile.java:1001)\n\tat org.apache.kahadb.page.PageFile.writeBatch(PageFile.java:1006)\n\tat org.apache.kahadb.page.PageFile.flush(PageFile.java:484)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1290)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$10.execute(MessageDatabase.java:768)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:760)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointCleanup(MessageDatabase.java:766)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$3.run(MessageDatabase.java:315)\n INFO | Ignoring IO exception, java.io.IOException: Input/output error\njava.io.IOException: Input/output error\n\tat java.io.RandomAccessFile.write(Native Method)\n\tat java.io.RandomAccessFile.writeLong(RandomAccessFile.java:1001)\n\tat org.apache.kahadb.page.PageFile.writeBatch(PageFile.java:1006)\n\tat org.apache.kahadb.page.PageFile.flush(PageFile.java:484)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointUpdate(MessageDatabase.java:1290)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$10.execute(MessageDatabase.java:768)\n\tat org.apache.kahadb.page.Transaction.execute(Transaction.java:760)\n\tat org.apache.activemq.store.kahadb.MessageDatabase.checkpointCleanup(MessageDatabase.java:766)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$3.run(MessageDatabase.java:315)\n WARN | Transport failed: java.io.EOFException\n{code}",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-3085.json",
        "creation_time": "2010-12-15T12:18:12.000+0000",
        "bug_report": {
            "Title": "IndexOutOfBoundsException on FailoverTransport.updateURIs after: already known: java.net.UnknownHostException",
            "Description": "broker returned hosts that are not resolvable on the client can throw the update logic in the failover transport off. Disabling update works around this (updateURIsSupported=false on the failover uri). It should be possible to disable the sending on the broker side also.\nsymptom:\n{code}2010-12-10 07:48:16,574 [ActiveMQ Transport: tcp://xx:61616] DEBUG  failover.FailoverTransport:228 - Transport failed with the following exception:\njava.io.IOException: Unexpected error occured\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:208) ~[activemq-core-5.4.1.jar:5.4.1-fuse-01-00]\n\tat java.lang.Thread.run(Thread.java:619) [na:1.6.0_12]\nCaused by: java.lang.IndexOutOfBoundsException: Index: 12, Size: 11\n\tat java.util.concurrent.CopyOnWriteArrayList.add(CopyOnWriteArrayList.java:409) ~[na:1.6.0_12]\n\tat org.apache.activemq.transport.failover.FailoverTransport.add(FailoverTransport.java:613) ~[activemq-core-5.4.1.jar:5.4.1-fuse-01-00]\n\tat org.apache.activemq.transport.failover.FailoverTransport.updateURIs(FailoverTransport.java:1046) ~[activemq-core-5.4.1.jar:5.4.1-fuse-01-00]\n\tat org.apache.activemq.transport.failover.FailoverTransport.processNewTransports(FailoverTransport.java:285) ~[activemq-core-5.4.1.jar:5.4.1-fuse-01-00]\n\tat org.apache.activemq.transport.failover.FailoverTransport.handleConnectionControl(FailoverTransport.java:265) ~[activemq-core-5.4.1.jar:5.4.1-fuse-01-00]\n\tat org.apache.activemq.transport.failover.FailoverTransport$3.onCommand(FailoverTransport.java:177) ~[activemq-core-5.4.1.jar:5.4.1-fuse-01-00]\n\tat org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113) ~[activemq-core-5.4.1.jar:5.4.1-fuse-01-00]\n\tat org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:228) ~[activemq-core-5.4.1.jar:5.4.1-fuse-01-00]\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83) ~[activemq-core-5.4.1.jar:5.4.1-fuse-01-00]\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:219) ~[activemq-core-5.4.1.jar:5.4.1-fuse-01-00]\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:201) ~[activemq-core-5.4.1.jar:5.4.1-fuse-01-00]\n\t... 1 common frames omitted{code}",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-3504.json",
        "creation_time": "2011-09-19T14:33:49.000+0000",
        "bug_report": {
            "Title": "NullPointerException on websocket connection",
            "Description": "When connecting from chrome or firefox 6 over websockets, I get the Null pointer below. It does not happen on firefox 5 or safari . My guess would be that the chrome and ff 6 are implementing a newer version of the websocket spec that is incompatible with the version that the activemq implements.     \n\n2011-09-19 09:18:33,931 | WARN  | /stomp | org.eclipse.jetty.util.log | qtp1545215993-39\njava.lang.NullPointerException\n        at org.apache.activemq.transport.ws.StompServlet.doGet(StompServlet.java:51)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:693)\n        at org.eclipse.jetty.websocket.WebSocketServlet.service(WebSocketServlet.java:73)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:806)\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:527)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:423)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:223)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:930)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:358)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:183)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:866)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:117)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:113)\n        at org.eclipse.jetty.server.Server.handle(Server.java:351)\n        at org.eclipse.jetty.server.HttpConnection.handleRequest(HttpConnection.java:594)\n        at org.eclipse.jetty.server.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:1042)\n        at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:549)\n        at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:211)\n        at org.eclipse.jetty.server.HttpConnection.handle(HttpConnection.java:424)\n        at org.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run(SocketConnector.java:241)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:436)\n        at java.lang.Thread.run(Thread.java:680)\n",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-6707.json",
        "creation_time": "2017-06-19T11:29:47.000+0000",
        "bug_report": {
            "Title": "JDBC XA: Could not remove prepared transaction state from message",
            "Description": "When ActiveMQ 5.14.5 is configured with jdbc persistence storage (postgres) from time to time below error occurs:\n{code}\n2017-06-15 01:41:37,418 | ERROR | enerContainer-21 | CommitTask                       | 67 - org.apache.aries.transaction.manager - 1.3.1 | Unexpected exception committing org.apache.geronimo.transaction.manager.WrapperNamedXAResource@34ac9d62; continuing to commit other RMs\njavax.transaction.xa.XAException: STORE COMMIT FAILED: Transaction rolled back xaErrorCode:104\n\tat org.apache.activemq.TransactionContext.toXAException(TransactionContext.java:793)\n\tat org.apache.activemq.TransactionContext.commit(TransactionContext.java:622)\n\tat org.apache.geronimo.transaction.manager.WrapperNamedXAResource.commit(WrapperNamedXAResource.java:54)\n\tat org.apache.geronimo.transaction.manager.CommitTask.run(CommitTask.java:64)\n\tat org.apache.geronimo.transaction.manager.TransactionImpl.commitResources(TransactionImpl.java:688)\n\tat org.apache.geronimo.transaction.manager.TransactionImpl.commit(TransactionImpl.java:327)\n\tat org.apache.geronimo.transaction.manager.TransactionManagerImpl.commit(TransactionManagerImpl.java:252)\n\tat org.springframework.transaction.jta.JtaTransactionManager.doCommit(JtaTransactionManager.java:1020)\n\tat org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:761)\n\tat org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:730)\n\tat org.apache.aries.transaction.internal.AriesPlatformTransactionManager.commit(AriesPlatformTransactionManager.java:75)\n\tat sun.reflect.GeneratedMethodAccessor180.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)[:1.8.0_131]\n\tat java.lang.reflect.Method.invoke(Method.java:498)[:1.8.0_131]\n\tat com.ectsp.spring.osgi.PlatformTransactionManagerFactoryBean$ProxyTxManagerHandler.invoke(PlatformTransactionManagerFactoryBean.java:115)[169:ectsp-spring-osgi:1.0.0.SNAPSHOT]\n\tat com.sun.proxy.$Proxy68.commit(Unknown Source)[100:org.apache.servicemix.bundles.spring-tx:4.2.8.RELEASE_1]\n\tat org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:245)[97:org.apache.servicemix.bundles.spring-jms:4.2.8.RELEASE_1]\n\tat org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1164)[97:org.apache.servicemix.bundles.spring-jms:4.2.8.RELEASE_1]\n\tat org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1156)[97:org.apache.servicemix.bundles.spring-jms:4.2.8.RELEASE_1]\n\tat org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:1053)[97:org.apache.servicemix.bundles.spring-jms:4.2.8.RELEASE_1]\n\tat java.lang.Thread.run(Thread.java:748)[:1.8.0_131]\nCaused by: javax.transaction.xa.XAException: STORE COMMIT FAILED: Transaction rolled back xaErrorCode:104\n\tat org.apache.activemq.transaction.Transaction.newXAException(Transaction.java:212)\n\tat org.apache.activemq.transaction.XATransaction.storeCommit(XATransaction.java:93)\n\tat org.apache.activemq.transaction.XATransaction.commit(XATransaction.java:76)\n\tat org.apache.activemq.broker.TransactionBroker.commitTransaction(TransactionBroker.java:252)\n\tat org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:118)\n\tat org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:118)\n\tat org.apache.activemq.broker.TransportConnection.processCommitTransactionTwoPhase(TransportConnection.java:547)\n\tat org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:102)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:336)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:200)\n\tat org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n\tat org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:125)\n\tat org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:301)\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:233)[47:org.apache.activemq.activemq-osgi:5.14.5]\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:215)[47:org.apache.activemq.activemq-osgi:5.14.5]\n\tat java.lang.Thread.run(Thread.java:745)[:1.8.0_131]\nCaused by: java.io.IOException: Could not remove prepared transaction state from message add for sequenceId: 4025171\n\tat org.apache.activemq.store.jdbc.adapter.DefaultJDBCAdapter.doCommitAddOp(DefaultJDBCAdapter.java:1031)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.commitAdd(JDBCPersistenceAdapter.java:780)\n\tat org.apache.activemq.store.jdbc.JdbcMemoryTransactionStore$CommitAddOutcome.run(JdbcMemoryTransactionStore.java:146)\n\tat org.apache.activemq.store.memory.MemoryTransactionStore$Tx.commit(MemoryTransactionStore.java:101)\n\tat org.apache.activemq.store.memory.MemoryTransactionStore.commit(MemoryTransactionStore.java:270)\n\tat org.apache.activemq.transaction.XATransaction.storeCommit(XATransaction.java:86)\n\t... 15 more\n{code}\nIt seams that it the same issue as in https://issues.apache.org/jira/browse/AMQ-5567.",
            "Priority": "Critical"
        }
    },
    {
        "filename": "AMQ-5384.json",
        "creation_time": "2014-10-06T09:26:58.000+0000",
        "bug_report": {
            "Title": "Deadlock on DB connections in JDBCMessageStore.removeMessage",
            "Description": "AMQ 5.9 gets stuck under 30-50 req/second load when using JDBC persistence - this affects our application as it hangs during performance testing (this happens almost every night).\nFollowing stacktraces indicate that there's a deadlock on DB connection:\n\nStack logged by C3P0, showing when first DB connection has been picked from the pool:\n{noformat}\n2014-10-06 08:44:40,646 | INFO  | Logging the stack trace by which the overdue resource was checked-out. | com.mchange.v2.resourcepool.BasicResourcePool | C3P0PooledConnectionPoolManager[identityToken->2x1e6s941raztn6mju110\njava.lang.Exception: DEBUG STACK TRACE: Overdue resource check-out stack trace.\n        at com.mchange.v2.resourcepool.BasicResourcePool.checkoutResource(BasicResourcePool.java:555)\n        at com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool.checkoutAndMarkConnectionInUse(C3P0PooledConnectionPool.java:756)\n        at com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool.checkoutPooledConnection(C3P0PooledConnectionPool.java:683)\n        at com.mchange.v2.c3p0.impl.AbstractPoolBackedDataSource.getConnection(AbstractPoolBackedDataSource.java:140)\n        at org.apache.activemq.store.jdbc.TransactionContext.getConnection(TransactionContext.java:58)\n        at org.apache.activemq.store.jdbc.TransactionContext.begin(TransactionContext.java:163)\n        at org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.beginTransaction(JDBCPersistenceAdapter.java:510)\n        at org.apache.activemq.store.memory.MemoryTransactionStore$Tx.commit(MemoryTransactionStore.java:92)\n        at org.apache.activemq.store.memory.MemoryTransactionStore.commit(MemoryTransactionStore.java:259)\n        at org.apache.activemq.transaction.XATransaction.storeCommit(XATransaction.java:85)\n        at org.apache.activemq.transaction.XATransaction.commit(XATransaction.java:75)\n        at org.apache.activemq.broker.TransactionBroker.commitTransaction(TransactionBroker.java:253)\n        at org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:112)\n        at org.apache.activemq.broker.TransportConnection.processCommitTransactionTwoPhase(TransportConnection.java:433)\n        at org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:102)\n        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:292)\n        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:149)\n        at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n        at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:270)\n        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n        at java.lang.Thread.run(Thread.java:662)\n{noformat}\n\nFollowing stack shows the same thread pending for second DB connection (without releasing the first one):\n{noformat}\n\"ActiveMQ Transport: tcp:///10.132.7.20:36431@5445\" daemon prio=10 tid=0x000000004119d000 nid=0x61bf in Object.wait() [0x00007f41120d7000]\n   java.lang.Thread.State: WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\t- waiting on <0x00000000fabdd2c0> (a com.mchange.v2.resourcepool.BasicResourcePool)\n\tat com.mchange.v2.resourcepool.BasicResourcePool.awaitAvailable(BasicResourcePool.java:1414)\n\tat com.mchange.v2.resourcepool.BasicResourcePool.prelimCheckoutResource(BasicResourcePool.java:606)\n\t- locked <0x00000000fabdd2c0> (a com.mchange.v2.resourcepool.BasicResourcePool)\n\tat com.mchange.v2.resourcepool.BasicResourcePool.checkoutResource(BasicResourcePool.java:526)\n\tat com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool.checkoutAndMarkConnectionInUse(C3P0PooledConnectionPool.java:756)\n\tat com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool.checkoutPooledConnection(C3P0PooledConnectionPool.java:683)\n\tat com.mchange.v2.c3p0.impl.AbstractPoolBackedDataSource.getConnection(AbstractPoolBackedDataSource.java:140)\n\tat org.apache.activemq.store.jdbc.TransactionContext.getConnection(TransactionContext.java:58)\n\tat org.apache.activemq.store.jdbc.adapter.DefaultJDBCAdapter.getStoreSequenceId(DefaultJDBCAdapter.java:290)\n\tat org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.getStoreSequenceIdForMessageId(JDBCPersistenceAdapter.java:840)\n\tat org.apache.activemq.store.jdbc.JDBCMessageStore.removeMessage(JDBCMessageStore.java:194)\n\tat org.apache.activemq.store.memory.MemoryTransactionStore$4.run(MemoryTransactionStore.java:348)\n\tat org.apache.activemq.store.memory.MemoryTransactionStore$Tx.commit(MemoryTransactionStore.java:103)\n\tat org.apache.activemq.store.memory.MemoryTransactionStore.commit(MemoryTransactionStore.java:259)\n\tat org.apache.activemq.transaction.XATransaction.storeCommit(XATransaction.java:85)\n\tat org.apache.activemq.transaction.XATransaction.commit(XATransaction.java:69)\n\tat org.apache.activemq.broker.TransactionBroker.commitTransaction(TransactionBroker.java:253)\n\tat org.apache.activemq.broker.MutableBrokerFilter.commitTransaction(MutableBrokerFilter.java:112)\n\tat org.apache.activemq.broker.TransportConnection.processCommitTransactionOnePhase(TransportConnection.java:424)\n\tat org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:100)\n\tat org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:292)\n\tat org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:149)\n\tat org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)\n\tat org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)\n\tat org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:270)\n\tat org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)\n\tat org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)\n\tat org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)\n\tat java.lang.Thread.run(Thread.java:662) \n{noformat}\n\nProblem seems to be related with JDBCMessageStore.removeMessage method:\n{code:java}\n    public void removeMessage(ConnectionContext context, MessageAck ack) throws IOException {\n    \tlong seq = persistenceAdapter.getStoreSequenceIdForMessageId(ack.getLastMessageId(), destination)[0];\n...\n{code}\n\nCall to {{removeMessage}} already has one DB connection passed in {{context}} method parameter, but calling {{persistenceAdapter.getStoreSequenceIdForMessageId}} creates another DB connection in the same transaction.\n\nDeadlock occurs when all DB connections are used by {{context}}, so that  {{removeMessage}} can't fetch its own connection.\n\nPossible solution would be to pass {{ConnectionContext}} object to {{persistenceAdapter.getStoreSequenceIdForMessageId}} method, so that the method would reuse same connection.",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-5783.json",
        "creation_time": "2015-05-20T08:47:56.000+0000",
        "bug_report": {
            "Title": "Failed to browse Topic: XXXXX java.io.EOFException: Chunk stream does not exist, page: y is marked free",
            "Description": "When an offline durable subscriber is timed out (offlineDurableSubscriberTimeout configured) periodically see the following WARNING message.   \n\n{code}\n\n2015-05-13 13:45:08,472 [sage] Scheduler] - WARN  Topic                          - Failed to browse Topic: XXXXX\njava.io.EOFException: Chunk stream does not exist, page: 39 is marked free\n\tat org.apache.activemq.store.kahadb.disk.page.Transaction$2.readPage(Transaction.java:470)\n\tat org.apache.activemq.store.kahadb.disk.page.Transaction$2.<init>(Transaction.java:447)\n\tat org.apache.activemq.store.kahadb.disk.page.Transaction.openInputStream(Transaction.java:444)\n\tat org.apache.activemq.store.kahadb.disk.page.Transaction.load(Transaction.java:420)\n\tat org.apache.activemq.store.kahadb.disk.page.Transaction.load(Transaction.java:377)\n\tat org.apache.activemq.store.kahadb.disk.index.BTreeIndex.loadNode(BTreeIndex.java:266)\n\tat org.apache.activemq.store.kahadb.disk.index.BTreeIndex.getRoot(BTreeIndex.java:174)\n\tat org.apache.activemq.store.kahadb.disk.index.BTreeIndex.iterator(BTreeIndex.java:236)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$MessageOrderIndex$MessageOrderIterator.<init>(MessageDatabase.java:3033)\n\tat org.apache.activemq.store.kahadb.MessageDatabase$MessageOrderIndex.iterator(MessageDatabase.java:2985)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore$4.execute(KahaDBStore.java:564)\n\tat org.apache.activemq.store.kahadb.disk.page.Transaction.execute(Transaction.java:779)\n\tat org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.recover(KahaDBStore.java:558)\n\tat org.apache.activemq.store.ProxyTopicMessageStore.recover(ProxyTopicMessageStore.java:62)\n\tat org.apache.activemq.broker.region.Topic.doBrowse(Topic.java:589)\n\tat org.apache.activemq.broker.region.Topic.access$100(Topic.java:65)\n\tat org.apache.activemq.broker.region.Topic$6.run(Topic.java:722)\n\tat org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)\n\tat java.util.TimerThread.mainLoop(Timer.java:555)\n\tat java.util.TimerThread.run(Timer.java:505)\n\n{code}",
            "Priority": "Major"
        }
    },
    {
        "filename": "AMQ-2965.json",
        "creation_time": "2010-10-07T20:18:59.000+0000",
        "bug_report": {
            "Title": "ActiveMQ fails to start if no DNS resolution for hostname is available",
            "Description": "ActiveMQ is installed on a physical server with two ethernet interfaces -- the first is a 10.x.x.x network and used only for external traffic , the second interface is a 172.x.x.x network and is used only for internal (intra-cluster node) communication. ActiveMQ is configured to listen only on the 172.x.x.x interface. External DNS resolution exists but internal DNS resolution does not. While each host has a unique name, none of these names are resolvable. Under these circumstances, ActiveMQ fails to start up successfully. Below are the exceptions and stack trace: \n\n{panel}\n2010-06-09 16:48:45,714 | ERROR | Failed to resolve localhost | org.apache.activemq.broker.BrokerService | WrapperSimpleAppMain \n2010-06-09 16:48:46,092 | INFO | Using Persistence Adapter: org.apache.activemq.store.kahadb.KahaDBPersistenceAdapter@47c297a3 | org.apache.activemq.broker.BrokerService | WrapperSimpleAppMain \n2010-06-09 16:48:46,928 | INFO | JMX consoles can connect to service:jmx:rmi://localhost:11616/jndi/rmi://localhost:1616/jmxrmi | org.apache.activemq.broker.jmx.ManagementContext | JMX connector \n2010-06-09 16:48:47,036 | INFO | ActiveMQ 5.3.2 JMS Message Broker (Q01M0003) is starting | org.apache.activemq.broker.BrokerService | WrapperSimpleAppMain \n2010-06-09 16:48:47,036 | INFO | For help or more information please see: http://activemq.apache.org/ | org.apache.activemq.broker.BrokerService | WrapperSimpleAppMain \n2010-06-09 16:48:47,280 | WARN | could not generate unique stub | org.apache.activemq.util.IdGenerator | WrapperSimpleAppMain \njava.net.UnknownHostException: Q01M0003: Q01M0003 \n        at java.net.InetAddress.getLocalHost(Unknown Source) \n        at org.apache.activemq.util.IdGenerator.&amp;lt;clinit&amp;gt;(IdGenerator.java:52) \n        at org.apache.activemq.broker.region.RegionBroker.&amp;lt;clinit&amp;gt;(RegionBroker.java:75) \n        at org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1734) \n        at org.apache.activemq.broker.BrokerService.createRegionBroker(BrokerService.java:1728) \n        at org.apache.activemq.broker.BrokerService.createBroker(BrokerService.java:1688) \n        at org.apache.activemq.broker.BrokerService.getBroker(BrokerService.java:706) \n        at org.apache.activemq.broker.BrokerService.start(BrokerService.java:469) \n        at org.apache.activemq.xbean.XBeanBrokerService.afterPropertiesSet(XBeanBrokerService.java:85) \n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) \n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source) \n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) \n        at java.lang.reflect.Method.invoke(Unknown Source) \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:1414) \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1375) \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1335) \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473) \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$1.run(AbstractAutowireCapableBeanFactory.java:409) \n        at java.security.AccessController.doPrivileged(Native Method) \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:380) \n        at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:264) \n        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222) \n        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:261) \n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:185) \n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:164) \n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:429) \n        at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:728) \n        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:380) \n        at org.apache.xbean.spring.context.ResourceXmlApplicationContext.&amp;lt;init&amp;gt;(ResourceXmlApplicationContext.java:64) \n        at org.apache.xbean.spring.context.ResourceXmlApplicationContext.&amp;lt;init&amp;gt;(ResourceXmlApplicationContext.java:52) \n        at org.apache.activemq.xbean.XBeanBrokerFactory.createApplicationContext(XBeanBrokerFactory.java:96) \n        at org.apache.activemq.xbean.XBeanBrokerFactory.createBroker(XBeanBrokerFactory.java:52) \n        at org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:71) \n        at org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:54) \n        at org.apache.activemq.console.command.StartCommand.startBroker(StartCommand.java:115) \n        at org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:74) \n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57) \n        at org.apache.activemq.console.command.ShellCommand.runTask(ShellCommand.java:136) \n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57) \n        at org.apache.activemq.console.command.ShellCommand.main(ShellCommand.java:82) \n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) \n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source) \n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) \n        at java.lang.reflect.Method.invoke(Unknown Source) \n        at org.apache.activemq.console.Main.runTaskClass(Main.java:251) \n        at org.apache.activemq.console.Main.main(Main.java:107) \n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) \n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source) \n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) \n        at java.lang.reflect.Method.invoke(Unknown Source) \n        at org.tanukisoftware.wrapper.WrapperSimpleApp.run(WrapperSimpleApp.java:240) \n        at java.lang.Thread.run(Unknown Source) \n2010-06-09 16:48:47,407 | ERROR | Failed to start ActiveMQ JMS Message Broker. Reason: java.io.IOException: Transport Connector could not be registered in JMX: Q01M0003: Q01M0003 | org.apache.activemq.broker.BrokerService | WrapperSimpleAppMain \njava.io.IOException: Transport Connector could not be registered in JMX: Q01M0003: Q01M0003 \n        at org.apache.activemq.util.IOExceptionSupport.create(IOExceptionSupport.java:27) \n        at org.apache.activemq.broker.BrokerService.registerConnectorMBean(BrokerService.java:1585) \n        at org.apache.activemq.broker.BrokerService.startTransportConnector(BrokerService.java:2006) \n        at org.apache.activemq.broker.BrokerService.startAllConnectors(BrokerService.java:1959) \n        at org.apache.activemq.broker.BrokerService.start(BrokerService.java:491) \n        at org.apache.activemq.xbean.XBeanBrokerService.afterPropertiesSet(XBeanBrokerService.java:85) \n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) \n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source) \n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) \n        at java.lang.reflect.Method.invoke(Unknown Source) \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:1414) \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1375) \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1335) \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473) \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$1.run(AbstractAutowireCapableBeanFactory.java:409) \n        at java.security.AccessController.doPrivileged(Native Method) \n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:380) \n        at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:264) \n        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222) \n        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:261) \n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:185) \n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:164) \n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:429) \n        at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:728) \n        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:380) \n        at org.apache.xbean.spring.context.ResourceXmlApplicationContext.&amp;lt;init&amp;gt;(ResourceXmlApplicationContext.java:64) \n        at org.apache.xbean.spring.context.ResourceXmlApplicationContext.&amp;lt;init&amp;gt;(ResourceXmlApplicationContext.java:52) \n        at org.apache.activemq.xbean.XBeanBrokerFactory.createApplicationContext(XBeanBrokerFactory.java:96) \n        at org.apache.activemq.xbean.XBeanBrokerFactory.createBroker(XBeanBrokerFactory.java:52) \n        at org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:71) \n        at org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:54) \n        at org.apache.activemq.console.command.StartCommand.startBroker(StartCommand.java:115) \n        at org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:74) \n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57) \n        at org.apache.activemq.console.command.ShellCommand.runTask(ShellCommand.java:136) \n        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57) \n        at org.apache.activemq.console.command.ShellCommand.main(ShellCommand.java:82) \n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) \n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source) \n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) \n        at java.lang.reflect.Method.invoke(Unknown Source) \n        at org.apache.activemq.console.Main.runTaskClass(Main.java:251) \n        at org.apache.activemq.console.Main.main(Main.java:107) \n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) \n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source) \n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) \n        at java.lang.reflect.Method.invoke(Unknown Source) \n        at org.tanukisoftware.wrapper.WrapperSimpleApp.run(WrapperSimpleApp.java:240) \n        at java.lang.Thread.run(Unknown Source) \nCaused by: java.net.UnknownHostException: Q01M0003: Q01M0003 \n        at java.net.InetAddress.getLocalHost(Unknown Source) \n        at org.apache.activemq.transport.tcp.TcpTransportServer.resolveHostName(TcpTransportServer.java:336) \n        at org.apache.activemq.transport.tcp.TcpTransportServer.bind(TcpTransportServer.java:142) \n        at org.apache.activemq.transport.tcp.TcpTransportFactory.doBind(TcpTransportFactory.java:60) \n        at org.apache.activemq.transport.TransportFactory.bind(TransportFactory.java:131) \n        at org.apache.activemq.broker.TransportConnector.createTransportServer(TransportConnector.java:305) \n        at org.apache.activemq.broker.TransportConnector.getServer(TransportConnector.java:137) \n        at org.apache.activemq.broker.TransportConnector.asManagedConnector(TransportConnector.java:100) \n        at org.apache.activemq.broker.BrokerService.registerConnectorMBean(BrokerService.java:1580) \n        ... 47 more \n2010-06-09 16:48:47,409 | INFO | ActiveMQ Message Broker (Q01M0003, null) is shutting down | org.apache.activemq.broker.BrokerService | WrapperSimpleAppMain \n2010-06-09 16:48:47,410 | INFO | Connector openwire Stopped | org.apache.activemq.broker.TransportConnector | WrapperSimpleAppMain \n2010-06-09 16:48:47,535 | INFO | ActiveMQ JMS Message Broker (Q01M0003, null) stopped | org.apache.activemq.broker.BrokerService | WrapperSimpleAppMain \n{panel}\n\nThis problem can be worked around by adding an entry to the /etc/hosts file for each machine. Unfortunately this presents quite a maintenance nightmare in a very large environment. ",
            "Priority": "Major"
        }
    }
]